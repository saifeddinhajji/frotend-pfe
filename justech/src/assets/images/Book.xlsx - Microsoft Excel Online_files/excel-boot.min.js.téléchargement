var Microsoft="object"==typeof Microsoft?Microsoft:{};Microsoft.Office=Microsoft.Office||{},Microsoft.Office.Excel=function(e){var t={};function i(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,function(t){return e[t]}.bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=16)}({16:function(e,t,i){"use strict";var o,n,s,r,a,c;i.r(t),function(e){e.boot="boot",e.dispose="dispose",e.postMessage="postMessage",e.raiseEvent="raiseEvent",e.rename="rename",e.switchMode="switchMode"}(o||(o={})),function(e){e.blurFocus="blurFocus",e.boot="boot",e.continueAccessibilityLoop="continueAccessibilityLoop",e.dispose="dispose",e.grabFocus="grabFocus",e.rename="rename",e.sendEmbeddedViewUrl="sendEmbeddedViewUrl",e.sendSessionInfo="sendSessionInfo",e.sendUserAccessAndPermissions="sendUserAccessAndPermissions",e.sendWopiInfo="sendWopiInfo",e.switchMode="switchMode"}(n||(n={})),function(e){e.AccessibilityLoopCompleted="App_AccessibilityLoopComplete",e.BootFailed="Wac_AppFailed",e.BootState="Wac_AppBootState",e.BootSucceeded="Wac_AppCompleted",e.BrowserEvent="BrowserEvent",e.Close="UI_Close",e.Conversation="UI_Conversation",e.CopyAndEdit="UI_CopyAndEdit",e.Download="UI_Download",e.Error="Error",e.FileEmbed="UI_FileEmbed",e.FileProperties="UI_FileProperties",e.FileRenamed="File_Rename",e.FileRenameFailed="File_RenameFailed",e.FileVersions="UI_FileVersions",e.FrameStateChanged="StateChanged",e.GetWopiInfoFromUrl="App_WopiInfoFromUrl",e.InitFrameLoaded="WacInitialize_FrameLoaded",e.InitReady="WacInitialize_Ready",e.LoadingStatus="App_LoadingStatus",e.ModeSwitched="App_SwitchMode",e.OpenInBrowser="UI_OpenInBrowser",e.OpenInClient="UI_OpenInClient",e.PageChanged="PageChanged",e.PushState="App_PushState",e.Reboot="App_DocReboot",e.RedeemForCommenting="UI_RedeemForCommenting",e.RefreshSessionInfo="App_RefreshSessionInfo",e.ReplyWithChanges="UI_ReplyWithChanges",e.ReportAbuse="UI_ReportAbuse",e.SaveStatus="UI_SaveStatus",e.SessionCompleteAck="WopiSession_Complete_Ack",e.Share="UI_Sharing",e.ShareForm="UI_ShareForm",e.SignIn="UI_SignIn",e.TrustFrame="App_IsFrameTrusted",e.Unloaded="App_Unloaded",e.UpdatePageCount="PageCount",e.UserAccessAndPermissions="UI_CheckUserAccessAndGrantPermissions",e.UserActivity="User_Activity",e.UserEditActivity="Edit_Notification",e.Workflow="UI_Workflow",e.ZoomChanged="ZoomChanged"}(s||(s={})),function(e){e.Ack="Ack",e.BlurFocus="Blur_Focus",e.BootFailedAck="Wac_AppFailed_Ack",e.BootSucceededAck="Wac_AppCompleted_Ack",e.ContinueAccessibilityLoop="Host_AccessibilityLoopComplete",e.FailSession="WopiPendingSession_Fail",e.GrabFocus="Grab_Focus",e.HostCacheDiagnostic="HostCacheDiagnostic",e.InitReadyAck="WacInitialize_Ready_Ack",e.JsApiDiagnostics="JsApiDiagnostics",e.PageChangedAck="PageChanged_Ack",e.PendingAppCompleteReceived="WopiPendingApplicationComplete_Received",e.PendingSessionComplete="WopiPendingSession_Complete",e.PopState="App_PopState",e.PostmessageReady="Host_PostmessageReady",e.Rename="File_Rename",e.SendEmbeddedViewUrl="CanEmbed",e.SendSessionInfo="Host_RefreshSessionInfo",e.SendUserAccessAndPermissions="CheckUserAccessAndGrantPermissions_Result",e.SendWopiInfo="Host_WopiInfoFromUrl",e.SetCurrentPage="SetCurrentPage",e.SetZoomLevel="SetZoomLevel",e.StartSessionComplete="WopiStartSession_Complete",e.SwitchMode="Host_SwitchMode",e.TrustFrame="Host_IsFrameTrusted",e.Unload="Host_Unload",e.UpdatePageCountAck="PageCount_Ack",e.ZoomChangedAck="ZoomChanged_Ack"}(r||(r={})),function(e){e.AccessibilityLoopCompleted="AccessibilityLoopCompleted",e.BootCompleted="BootCompleted",e.BrowserEvent="BrowserEvent",e.Close="Close",e.Conversation="Conversation",e.CopyAndEdit="CopyAndEdit",e.Disposed="Disposed",e.Download="Download",e.Error="Error",e.FileEmbed="FileEmbed",e.FileProperties="FileProperties",e.FileRenamed="FileRenamed",e.FileRenameFailed="FileRenameFailed",e.FileVersions="FileVersions",e.FrameStateChanged="FrameStateChanged",e.GetWopiInfoFromUrl="GetWopiInfoFromUrl",e.ModeSwitched="ModeSwitched",e.OpenInBrowser="OpenInBrowser",e.OpenInClient="OpenInClient",e.PageChanged="PageChanged",e.Reboot="Reboot",e.RedeemForCommenting="RedeemForCommenting",e.RefreshSessionInfo="RefreshSessionInfo",e.ReplyWithChanges="ReplyWithChanges",e.ReportAbuse="ReportAbuse",e.SaveStatus="SaveStatus",e.SessionCreated="SessionCreated",e.Share="Share",e.ShareForm="ShareForm",e.SignIn="SignIn",e.UserAccessAndPermissions="UserAccessAndPermissions",e.UserActivity="UserActivity",e.UserEditActivity="UserEditActivity",e.Workflow="Workflow",e.ZoomChanged="ZoomChanged"}(a||(a={}));var p=((c={})[n.boot]={flowId:o.boot},c[n.dispose]={flowId:o.dispose},c[n.rename]={flowId:o.rename},c[n.switchMode]={flowId:o.switchMode},c[s.FileEmbed]={flowId:o.raiseEvent,eventId:a.FileEmbed},c[s.GetWopiInfoFromUrl]={flowId:o.raiseEvent,eventId:a.GetWopiInfoFromUrl},c[s.RefreshSessionInfo]={flowId:o.raiseEvent,eventId:a.RefreshSessionInfo},c[s.UserAccessAndPermissions]={flowId:o.raiseEvent,eventId:a.UserAccessAndPermissions},c[n.blurFocus]={flowId:o.postMessage,messageId:r.BlurFocus},c[n.continueAccessibilityLoop]={flowId:o.postMessage,messageId:r.ContinueAccessibilityLoop},c[n.grabFocus]={flowId:o.postMessage,messageId:r.GrabFocus},c[n.sendEmbeddedViewUrl]={flowId:o.postMessage,messageId:r.SendEmbeddedViewUrl},c[n.sendSessionInfo]={flowId:o.postMessage,messageId:r.SendSessionInfo},c[n.sendUserAccessAndPermissions]={flowId:o.postMessage,messageId:r.SendUserAccessAndPermissions},c[n.sendWopiInfo]={flowId:o.postMessage,messageId:r.SendWopiInfo},c[s.AccessibilityLoopCompleted]={flowId:o.raiseEvent,eventId:a.AccessibilityLoopCompleted},c[s.BrowserEvent]={flowId:o.raiseEvent,eventId:a.BrowserEvent},c[s.Close]={flowId:o.raiseEvent,eventId:a.Close},c[s.Conversation]={flowId:o.raiseEvent,eventId:a.Conversation},c[s.CopyAndEdit]={flowId:o.raiseEvent,eventId:a.CopyAndEdit},c[s.Download]={flowId:o.raiseEvent,eventId:a.Download},c[s.Error]={flowId:o.raiseEvent,eventId:a.Error},c[s.FileProperties]={flowId:o.raiseEvent,eventId:a.FileProperties},c[s.FileRenamed]={flowId:o.raiseEvent,eventId:a.FileRenamed},c[s.FileRenameFailed]={flowId:o.raiseEvent,eventId:a.FileRenameFailed},c[s.FileVersions]={flowId:o.raiseEvent,eventId:a.FileVersions},c[s.FrameStateChanged]={flowId:o.raiseEvent,eventId:a.FrameStateChanged},c[s.ModeSwitched]={flowId:o.raiseEvent,eventId:a.ModeSwitched},c[s.OpenInBrowser]={flowId:o.raiseEvent,eventId:a.OpenInBrowser},c[s.OpenInClient]={flowId:o.raiseEvent,eventId:a.OpenInClient},c[s.PageChanged]={flowId:o.raiseEvent,eventId:a.PageChanged},c[s.RedeemForCommenting]={flowId:o.raiseEvent,eventId:a.RedeemForCommenting},c[s.ReplyWithChanges]={flowId:o.raiseEvent,eventId:a.ReplyWithChanges},c[s.ReportAbuse]={flowId:o.raiseEvent,eventId:a.ReportAbuse},c[s.SaveStatus]={flowId:o.raiseEvent,eventId:a.SaveStatus},c[s.Share]={flowId:o.raiseEvent,eventId:a.Share},c[s.ShareForm]={flowId:o.raiseEvent,eventId:a.ShareForm},c[s.SignIn]={flowId:o.raiseEvent,eventId:a.SignIn},c[s.UserActivity]={flowId:o.raiseEvent,eventId:a.UserActivity},c[s.UserEditActivity]={flowId:o.raiseEvent,eventId:a.UserEditActivity},c[s.Workflow]={flowId:o.raiseEvent,eventId:a.Workflow},c[s.ZoomChanged]={flowId:o.raiseEvent,eventId:a.ZoomChanged},c);function l(e){if(void 0===e)throw new TypeError("SessionInitParams");if(void 0===e.hostSessionId)throw new TypeError("HostSessionId")}function d(e){if(void 0===e)throw new TypeError("SessionBootParams");var t=e.applicationUrl,i=e.applicationBaseUrl;if(void 0===t&&void 0===i)throw new TypeError("Either applicationUrl or applicationBaseUrl should exist");if(void 0!==t&&"string"!=typeof t)throw new TypeError("ApplicationUrl");if(void 0!==i&&"string"!=typeof i)throw new TypeError("ApplicationBaseUrl");var o=e.file;if(void 0===o||void 0===o.name)throw new TypeError("FileInfo");var n=e.containerElement;if(void 0===n||void 0===n||void 0===n.appendChild)throw new TypeError("ContainerElement");var s=e.wopi;if(void 0===s||void 0===s.source||void 0===s.accessToken||void 0===s.expiry)throw new TypeError("WopiInfo")}var g,u,f=function(){function e(){}return e.prototype.sendTraceTag=function(){},e.prototype.shipAssertTag=function(){},e.prototype.debugAssertTag=function(){},e}();!function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(g||(g={})),function(e){e[e.msoulscat_ES_EWAJS=0]="msoulscat_ES_EWAJS",e[e.msoulscat_ES_EWAJSGrid=1]="msoulscat_ES_EWAJSGrid",e[e.msoulscat_ES_EWAJSChart=6]="msoulscat_ES_EWAJSChart",e[e.msoulscat_Wac_WordViewer=301]="msoulscat_Wac_WordViewer",e[e.msoulscat_Wac_BrowserGeneral=306]="msoulscat_Wac_BrowserGeneral",e[e.msoulscat_Wac_TaskPane=320]="msoulscat_Wac_TaskPane",e[e.msoulscat_Wac_OneNoteGeneral=339]="msoulscat_Wac_OneNoteGeneral",e[e.msoulscat_Wac_Ribbon=340]="msoulscat_Wac_Ribbon",e[e.msoulscat_Wac_WopiPendingApplication=379]="msoulscat_Wac_WopiPendingApplication",e[e.msoulscat_Wac_Telemetry=383]="msoulscat_Wac_Telemetry",e[e.msoulscat_Wac_WacCatchUpActivities=391]="msoulscat_Wac_WacCatchUpActivities",e[e.msoulscat_Wac_Dictation=394]="msoulscat_Wac_Dictation",e[e.msoulscat_Wac_OneNoteSync=395]="msoulscat_Wac_OneNoteSync",e[e.msoulscat_Wac_VisioApp=700]="msoulscat_Wac_VisioApp",e[e.msoulscat_OneNoteOnline_EditableCache=1601]="msoulscat_OneNoteOnline_EditableCache",e[e.msoulscat_Wac_PptAnimation=800]="msoulscat_Wac_PptAnimation",e[e.msoulscat_Wac_PptLive=833]="msoulscat_Wac_PptLive",e[e.msoulscat_Wac_PptMWeb=834]="msoulscat_Wac_PptMWeb",e[e.msoulscat_Wac_PptShape=815]="msoulscat_Wac_PptShape",e[e.msoulscat_Wac_PptSession=817]="msoulscat_Wac_PptSession",e[e.msoulscat_Wac_PptSlideshow=830]="msoulscat_Wac_PptSlideshow",e[e.msoulscat_Wac_VersionHistory=2300]="msoulscat_Wac_VersionHistory",e[e.msoulscat_Wac_WordPresence=302]="msoulscat_Wac_WordPresence",e[e.msoulscat_Wac_WordVersionHistory=3005]="msoulscat_Wac_WordVersionHistory",e[e.msoulscat_Wac_LivePersonaCard=3006]="msoulscat_Wac_LivePersonaCard",e[e.msoulscat_Wac_CatchUpFlyout=3012]="msoulscat_Wac_CatchUpFlyout"}(u||(u={}));var h;(function(){function e(){}e.tagIntToString=function(t){return t<=e.maxNumericTag?t.toString():t>>24>=this.minOldSchemeHighByteValue?String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,255&t):e.map.charAt(t>>24&63)+e.map.charAt(t>>18&63)+e.map.charAt(t>>12&63)+e.map.charAt(t>>6&63)+e.map.charAt(63&t)},e.getLogMessage=function(t,i,o){return"tag_"+e.tagIntToString(t)+" ["+u[i]+"] "+o},e.prototype.sendTraceTag=function(t,i,o,n){var s=console.log;switch(o){case g.Error:s=console.error;break;case g.Warning:s=console.warn;break;case g.Info:s=console.info;break;case g.Verbose:s=console.debug;break;case g.Spam:default:s=console.log}try{s(e.getLogMessage(t,i,n))}catch(e){var r="undefined"!=typeof navigator?navigator:void 0;if(r&&!/rv:11.0/i.test(r.userAgent))throw e}},e.prototype.shipAssertTag=function(t,i,o,n){console.assert(o,e.getLogMessage(t,i,n))},e.prototype.debugAssertTag=function(e,t,i,o){this.shipAssertTag(e,t,i,o)},e.maxNumericTag=65535,e.minOldSchemeHighByteValue=36,e.map="abcdefghijklmnopqrstuvwxyz0123456789"})(),new(function(){function e(){this.externalLogger=new f}return e.prototype.setLogger=function(e){this.externalLogger=e},e.prototype.sendTraceTag=function(e,t,i,o){this.externalLogger.sendTraceTag(e,t,i,o)},e.prototype.debugAssertTag=function(e,t,i,o){this.externalLogger.debugAssertTag(e,t,i,o)},e.prototype.shipAssertTag=function(e,t,i,o){this.externalLogger.shipAssertTag(e,t,i,o)},e}());function m(e,t,i){if(""!==t){var o=new XMLHttpRequest;o.readyState!==XMLHttpRequest.UNSENT&&o.readyState!==XMLHttpRequest.DONE||(o.open("POST",t,i),o.send(e))}}function w(e,t,i,o){var n=e.map((function(e){return function(e,t){var i={};i.G=e.tag,i.T=e.timestamp-t,i.M=e.message,i.C=e.category;var o=1e3*e.type+e.level;return i.D=o,i}(e,o)})),s=function(e,t,i,o){var n={};return n.T=e,n.L=t,n.S=i,n.I=o,n.V=1,n}(o,n,t,i);return JSON.stringify(s)}!function(e){e[e.Trace=0]="Trace",e[e.Assert=1]="Assert"}(h||(h={}));!function(){function e(t,i){var o=this;this.uploadId=0,this.logCache=[],this.timestampBase=Date.now(),this.userSessionId="00000000-0000-0000-0000-000000000000",this.flushOnClose=function(){o.triggerUpload(!1,!1)},this.flush=function(){o.triggerUploadAsync()},this.triggerUploadAsync=function(){window.setTimeout((function(){return o.triggerUpload(!0,!0)}),0)},this.triggerUpload=function(t,i){(window.clearTimeout(o.timeoutId),o.logCache.length>0)&&(o.uploadId+=1,m(w(o.logCache,o.userSessionId,o.uploadId,o.timestampBase),o.remoteUrlEndpoint,i),o.logCache=[],o.timestampBase=Date.now());t&&(o.timeoutId=window.setTimeout(o.triggerUploadAsync,e.uploadCadenceInMsSec))},this.userSessionId=t,this.remoteUrlEndpoint=i+"?usid="+t,window.setTimeout((function(){return o.triggerUpload(!0,!0)}),0)}e.prototype.handleTrace=function(t){t.message.length>e.messageMaxChars&&(t.message=t.message.substr(0,e.messageMaxChars-e.trimmedMessage.length)+e.trimmedMessage),this.logCache.push(t),(this.logCache.length>e.uploadTriggerSize||t.level===g.Error)&&this.triggerUploadAsync()},e.messageMaxChars=3072,e.uploadCadenceInMsSec=3e4,e.uploadTriggerSize=30,e.trimmedMessage="... [Trimmed]"}();g.Info;

var S=function(e,t){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function v(e,t){function i(){this.constructor=e}S(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var I=function(){return(I=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};var y;!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}v(t,e)}(f);function T(e){return JSON.stringify(e,Object.getOwnPropertyNames(e))}function A(e,t){return{isFeatureEnabled:function(i){return function(e,t,i){if(!t)return;try{return t(e)}catch(e){i&&i.ULS.traceTag(594883024,u.msoulscat_Wac_WopiPendingApplication,g.Error,"Host encountered error in featuremanager callback: "+T(e))}return}(i,e,t)}}}!function(e){e.Unknown="UNKNOWN",e.Initialized="INITIALIZED",e.Prebooted="PREBOOTED",e.Booting="BOOTING",e.Booted="BOOTED",e.Failed="FAILED",e.Disposing="DISPOSING",e.Disposed="DISPOSED"}(y||(y={}));var F=function(){function e(e,t){var i=this;this.messageMaxChars=3072,this.trimmedMessage="... [Trimmed]",this.fastUploadCadenceInMsSec=1e3,this.uploadCadenceInMsSec=3e4,this.uploadTriggerSize=30,this.uploadId=0,this.logCache=[],this.timestampBase=Date.now(),this.userSessionId="00000000-0000-0000-0000-000000000000",this.flushOnClose=function(){i.triggerUpload(!1,!1)},this.flush=function(){i.triggerUploadAsync()},this.triggerUploadAsync=function(){window.setTimeout((function(){return i.triggerUpload(!0,!0)}),0)},this.triggerUpload=function(e,t){if(window.clearTimeout(i.timeoutId),i.remoteUrlEndpoint){if(i.logCache.length>0)i.uploadId+=1,m(w(i.logCache.splice(0,e?i.uploadTriggerSize:i.logCache.length),i.userSessionId,i.uploadId,i.timestampBase),i.remoteUrlEndpoint,t),i.timestampBase=Date.now();e&&(i.timeoutId=window.setTimeout(i.triggerUploadAsync,i.logCache.length>i.uploadTriggerSize?i.fastUploadCadenceInMsSec:i.uploadCadenceInMsSec))}},this.userSessionId=e,t&&this.configure(t)}return e.prototype.configure=function(e){var t=this;if(e.uploadCadenceInMsSec&&(this.uploadCadenceInMsSec=e.uploadCadenceInMsSec),e.uploadTriggerSize&&(this.uploadTriggerSize=e.uploadTriggerSize),e.remoteUlsEndpoint){if(this.remoteUrlEndpoint)throw new Error("Remote ULS endpoint is already set");this.remoteUrlEndpoint=e.remoteUlsEndpoint+"?usid="+this.userSessionId,this.timestampBase=Date.now(),window.setTimeout((function(){return t.triggerUpload(!0,!0)}),0)}},e.prototype.handleTrace=function(e){e.message.length>this.messageMaxChars&&(e.message=e.message.substr(0,this.messageMaxChars-this.trimmedMessage.length)+this.trimmedMessage),this.logCache.push(e),(this.logCache.length>this.uploadTriggerSize||e.level===g.Error)&&this.triggerUploadAsync()},e}();function C(e,t){var i=new F(e,t);function o(e,t,o,n){var s={timestamp:Date.now(),category:t,tag:e,level:o,type:h.Trace,message:n};i.handleTrace(s)}return{ULS:{sendTraceTag:function(e,t,i,n){o(e,t,i,n)},shipAssertTag:function(e,t,i,n){i&&o(e,t,g.Error,n)},debugAssertTag:function(e,t,i,o){throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")},flush:i.flush,flushOnClose:i.flushOnClose},configure:function(e){i.configure(e)}}}function P(){var e=new Uint8Array(31),t=function(e){var t={crypto:!1,perfNow:!1,exceptions:[]},i=window.crypto||window.msCrypto;if(i){t.crypto=!0;try{return i.getRandomValues(e),t}catch(e){t.exceptions.push("crypto: "+T(e))}}var o=!1,n=window.performance;try{n&&n.now&&n.now()!==1/0&&(o=!0)}catch(e){t.exceptions.push("perfNow: "+T(e))}for(var s=0;s<e.length;s+=1){try{if(o){t.perfNow=!0;var r=Math.floor(100*n.now())%10;(r<0||r>9)&&(r=0);for(var a=0;a<r;a+=1)Math.random()}}catch(e){t.exceptions.push("Math.random: "+T(e))}e[s]=Math.floor(16*Math.random())}return t}(e),i=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var o=15&e[i];return i+=1,("x"===t?o:3&o|8).toString(16)})),t]}var W=function(){function e(e,t,i,o,n){var s=this;this.applicationPathUrl="",this.appUrl="",this.actionHandlers={},this.onMessage=function(e){var t=e.MessageId,i=e.Values;if(s.actionHandlers[t])s.dispatchAction(t,i);else{var o=p[t];o&&o.flowId&&s.flows[o.flowId](t,s,i)}};var r=P(),a=r[0],c=r[1];this.logger=C(a),this.logger.ULS.sendTraceTag(593506837,u.msoulscat_Wac_WopiPendingApplication,g.Info,JSON.stringify(c)),this.state=y.Unknown,this.sessionId=a,this.hostSessionId=t.hostSessionId,this.host=e.host,this.user=e.user,this.bootstrapperUrl=e.bootstrapperUrl,this.hostCapabilities=e.hostCapabilities,this.uiSettings=e.uiSettings,this.viewModeSettings=e.viewModeSettings,this.featureManager=i,this.flows=o,this.sessionEventHandler=n}return e.prototype.raiseEvent=function(e,t){try{this.sessionEventHandler(e,t)}catch(e){this.logger.ULS.sendTraceTag(593506838,u.msoulscat_Wac_WopiPendingApplication,g.Error,"Event handler error: "+T(e))}},e.prototype.addActionHandler=function(e,t){this.actionHandlers[e]||(this.actionHandlers[e]=[]),this.actionHandlers[e].push(t)},e.prototype.removeActionHandler=function(e,t){var i=this.actionHandlers[e];if(i&&i.length>0){var o=i.indexOf(t);o>-1&&i.splice(o,1)}},e.prototype.run=function(e,t,i){var o=[];if(this.actionHandlers[e])o.push(this.dispatchAction(e,t));else{var n=p[e];n&&n.flowId?o.push(this.flows[n.flowId](e,this,t,i)):(o.push(Promise.resolve({completion:"failure"})),this.logger.ULS.sendTraceTag(593500189,u.msoulscat_Wac_WopiPendingApplication,g.Warning,"Unhandled command: "+e))}return i&&o.push(new Promise((function(e){window.setTimeout(e,i,{completion:"timeout"})}))),Promise.race(o)},e.prototype.dispatchAction=function(e,t,i){var o=this;return this.actionHandlers[e].map((function(n){try{n(e,o,t,i)}catch(e){o.logger.ULS.sendTraceTag(593773709,u.msoulscat_Wac_WopiPendingApplication,g.Error,"Action handler error: "+T(e))}})),Promise.resolve({completion:"success"})},e}(),U=function(){function e(e,t,i,o,n,s){var r=this;this.context=new W(e,t,i,s(),(function(e,t){return o(e,r,t)})),this.application=n;var c={session:this};this.context.raiseEvent(a.SessionCreated,c),this.context.state=y.Initialized}return e.prototype.getSessionId=function(){return this.context.sessionId},e.prototype.getDiagnostics=function(){return I(I({},this.context.hostInitDiagnostics),this.context.appInitDiagnostics)},e.prototype.run=function(e,t,i){return this.context.run(e,t,i)},e.prototype.boot=function(e,t){return this.context.run(n.boot,e,t)},e.prototype.dispose=function(e){return this.context.run(n.dispose,void 0,e)},e}(),E= "16.0.12812.35050";function b(){return E}var O,M;!function(){function e(e,t,i){var o=this;this.eventHandlers=[],this.sessions=[],this.containers=[],this.removeSessionOnDisposed=function(e,t){if(e===a.Disposed){var i=o.sessions.indexOf(t);i>-1&&o.sessions.splice(i,1)}},this.dispatchEvent=function(e,t,i){o.eventHandlers.forEach((function(o){return o(e,t,i)}))},function(e){if(void 0===e)throw new TypeError("ApplicationInitParams");var t=e.host;if(void 0===t||void 0===t.storageHostName)throw new TypeError("HostInfo");var i=e.user;if(void 0===i||void 0===i.id)throw new TypeError("UserInfo")}(e),this.applicationInitParams=e,this.applicationName=t,this.flowFactory=i,this.featureManager=A(e.hostCapabilities&&e.hostCapabilities.isFeatureEnabledCallback),this.addEventHandler(this.removeSessionOnDisposed)}e.prototype.getApplicationName=function(){return this.applicationName},e.prototype.getVersion=function(){return b()},e.prototype.prefetch=function(){throw new Error("Not implemented")},e.prototype.addEventHandler=function(e){this.eventHandlers.push(e)},e.prototype.removeEventHandler=function(e){var t=this.eventHandlers.indexOf(e);t>-1&&this.eventHandlers.splice(t,1)},e.prototype.createSession=function(e){l(e);var t=new U(this.applicationInitParams,e,this.featureManager,this.dispatchEvent,this,this.flowFactory);return this.sessions.push(t),t},e.prototype.bootDocument=function(e,t){return function(e){if(void 0===e)throw new TypeError("DocumentBootParams");l(e),d(e)}(e),this.createSession(e).boot(e,t)},e.prototype.dispose=function(e){var t=this.sessions.map((function(t){return t.dispose(e).then((function(e){return"success"!==e.completion&&(e.error="Failed, sessionId: "+t.getSessionId()),e})).catch((function(e){return{completion:"failure",error:"Failed, sessionId: "+t.getSessionId()}}))}));return Promise.all(t).then((function(e){var t={completion:"success"},i=[];return e.forEach((function(e){"success"!==e.completion&&(t.completion="failure",e.error&&i.push(e.error+";"))})),t.error=i.join(" "),t}))}}();function R(e){return 8===e.toLowerCase().indexOf("ffc")}function L(e){return 8===e.toLowerCase().indexOf("ppc")}function _(e){var t=e.match(/^(.*?\/\/[^\/]+)(.*)$/);if(!t)throw new Error("Invalid URL");return t[1]}function x(e,t){var i=e.match(/^(.*?\/\/)([^\/:]+)(.*)$/);if(!i)throw new Error("Invalid URL");var o=i[2];if(void 0===t)return o;if(t<0)throw new Error("subDomainParts should be at least 1");return o.split(".").slice(-(t+1)).join(".")}function D(e){var t=e.match(/^(.*?\/\/[^\/]+\/[^\/]+\/)(.*)$/);if(!t)throw new Error("Invalid URL");return t[1]}!function(e){e.H2StaticContent="H2StaticContent",e.InstantShell="InstantShell",e.EnterpriseTemplates="EnterpriseTemplates",e.HashedUrl="HashedUrl",e.ExcelAdaptiveLayoutDownload="ExcelAdaptiveLayoutDownload",e.ExcelLandingPageObserverRetry="ExcelLandingPageObserverRetry",e.OfficeComUiHost="OfficeComUiHost",e.ODCShareLinkPreload="ODCShareLinkPreload"}(O||(O={})),function(e){e.Unknown="Unknown",e.AppInitError="AppInitError",e.ApiDisabledError="ApiDisabledError",e.CannotLoadFirstPage="CannotLoadFirstPage",e.CannotLoadScript="CannotLoadScript",e.PageChangeError="PageChangeError",e.ZoomChangeError="ZoomChangeError",e.CannotLoadBundleItem="CannotLoadBundleItem",e.InvalidPageIndex="InvalidPageIndex",e.UnsupportedBundleVersion="UnsupportedBundleVersion",e.InvalidWopiInfo="InvalidWopiInfo",e.TimeoutWacReady="TimeoutWacReady",e.WacFailed="WacFailed"}(M||(M={}));var H,k,B={ExcelEwaJs:u.msoulscat_ES_EWAJS,WordViewer:u.msoulscat_Wac_WordViewer,WopiPendingApplication:u.msoulscat_Wac_WopiPendingApplication,VisioApp:u.msoulscat_Wac_VisioApp,PptSession:u.msoulscat_Wac_PptSession};function N(e,t){var i=e.indexOf("&"+t+"=");if(-1===i&&(i=e.indexOf("?"+t+"=")),-1===i)return"";var o=i+(t.length+2),n=e.indexOf("&",o);return-1===n?e.substr(o):e.substring(o,n)}function z(e,t,i,o){if(void 0===o&&(o=!1),!i)return e;var n=e,s=n.indexOf("?"),r="&";s===n.length-1||"&"===n.slice(-1)||"&>"===n.slice(-2)?r="":-1===s&&(r="?");var a=t.toLowerCase()+"=",c=n.toLowerCase().indexOf(a,s);if("?"!==r&&c>=0){if(o){var p=n.indexOf("&",c);n=n.substring(0,c)+a+i+(-1===p?"":n.substring(p))}return n}return n.concat(r,a,i)}function V(e){if(null==e)return"";var t=-1===e.indexOf("#")?e.length:e.indexOf("#"),i=e.lastIndexOf("/",t);if(-1!==i&&i+1===e.indexOf("://")+"://".length)return"";i+=1;var o=e.indexOf("?");if(-1!==(o=o>=t?-1:o)&&i>o)return"";var n=-1===o?t:o;return i>=n?"":e.substring(i,n)}function J(e,t){t&&t.Diagnostics&&Object.keys(t.Diagnostics).forEach((function(i){return e[i]=t.Diagnostics[i]}))}function j(){if(window&&window.navigator){var e=window.navigator,t=e.connection||e.mozConnection||e.webkitConnection,i={};return t&&(i.netEffectiveType=t.effectiveType,i.netDownlink=t.downlink,i.netType=t.type,i.netDownlinkMax=t.downlinkMax,i.netRtt=t.rtt,i.netSaveData=t.saveData),i.deviceMemory=e.deviceMemory,i.logicalProcessors=e.hardwareConcurrency,i}}function G(e,t,i){t.ULS.traceTag(596459999,B.WopiPendingApplication,i,"SessionTraces: "+JSON.stringify(e))}function q(e,t,i){i.Stop();var o=i.GetVisibilityChangeEvents();null!=o&&o.length>0&&(e.documentLoadedWithTabSwitch=!0,t.tabSwitchDiagnostics=JSON.stringify(o)),i.Dispose()}function Z(e){try{if(void 0===window.performance)return void e.ULS.traceTag(595948609,B.WopiPendingApplication,g.Info,"Performance not supported");var t=window.performance.getEntriesByType("resource");if(void 0===t||t.length<=0)return void e.ULS.traceTag(595948610,B.WopiPendingApplication,g.Info,"No resources under performance");for(var i=new RegExp("excel-boot.min.js|word.boot.js|visio.boot.js|onenote-boot.js","i"),o=0,n=t;o<n.length;o++){var s=n[o];if(i.test(s.name)){var r=JSON.stringify(s),a=V(s.name);return r=r.replace(new RegExp(s.name,"g"),a),void e.ULS.traceTag(595948616,B.WopiPendingApplication,g.Info,r)}}e.ULS.traceTag(595948484,B.WopiPendingApplication,g.Info,"Could not find JSAPI resource timing entry")}catch(t){e.ULS.traceTag(595948617,B.WopiPendingApplication,g.Info,"Could not trace the resource timing: "+T(t))}}function X(e,t,i){if(e){var o="Page lifecycle: "+t+" fired.";o+=i?" Flushing ULS logger":"",e.ULS.traceTag(595957843,B.WopiPendingApplication,g.Info,o),i&&e.ULS.flush()}}function $(e,t,i){e.ULS.traceTag(596464283,B.WopiPendingApplication,g.Info,"Initializing session. Build version: "+b()),i&&e.ULS.traceTag(595937313,B.WopiPendingApplication,g.Info,JSON.stringify(i)),t.rebootOverrideData&&(t.rebootOverrideData.previousSessionId||e.ULS.traceTag(594613645,B.WopiPendingApplication,g.Warning,"Missing previous session id")),e.ULS.traceTag(595632928,B.WopiPendingApplication,g.Info,function(){if(window&&window.navigator){var e=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection;if(e)return"EffectiveType: "+e.effectiveType+", BandwidthMps: "+e.downlink+", ConnectionType: "+e.type}return""}()),t&&t.wopiInfo&&t.wopiInfo.AccessToken&&t.wopiInfo.AccessTokenExpiry?(0===t.wopiInfo.AccessToken.length||t.wopiInfo.AccessTokenExpiry.getTime()<=Date.now())&&e.ULS.traceTag(595894621,B.WopiPendingApplication,g.Error,"Invalid AccessToken. AccessTokenLength: "+t.wopiInfo.AccessToken.length+", AccessTokenExpiry: "+t.wopiInfo.AccessTokenExpiry+", AccessTokenTTL: "+t.wopiInfo.AccessTokenExpiry.getTime()+", DateNow: "+Date.now()):e.ULS.traceTag(595894553,B.WopiPendingApplication,g.Warning,"There are some missing paramters");var o=function(e,t){var i=JSON.parse(JSON.stringify(t));delete i.UserId,delete i.OwnerId,delete i.WdParams;var o=t.WdParams?JSON.parse(JSON.stringify(t.WdParams).toLowerCase()):{};return i.WdParams={},["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((function(e){o[e]&&(i.WdParams[e]=o[e])})),i.UiEmbedMode=e.toLowerCase().indexOf("uiembed=1")>=0,i.UiHostName=N(e,"uih")||"N/A",i.hostName=location?location.hostname:"",i}(t.applicationUrl,t.sessionInformation);e.ULS.traceTag(596444237,B.WopiPendingApplication,g.Info,JSON.stringify({hostSessionInformation:o,clientSignals:j()})),e.ULS.traceTag(596444238,B.WopiPendingApplication,g.Info,"HostInitDiagnostics: "+(t.diagnostics.HostInitializeDiagnostics?JSON.stringify(t.diagnostics.HostInitializeDiagnostics):"N/A"))}function K(){if(null!=navigator&&null!=navigator.userAgent){var e=navigator.userAgent;if(e.indexOf("Firefox")>-1)return H.Firefox;if(e.indexOf("Opera")>-1)return H.Opera;if(e.indexOf("Trident")>-1)return H.IE;if(e.indexOf("Edge")>-1)return H.Edge;if(e.indexOf("Chrome")>-1)return H.Chrome;if(e.indexOf("Safari")>-1)return H.Safari}return H.Unknown}function Q(){try{return navigator.userAgent.indexOf("iPad")>=0||navigator.userAgent.indexOf("Macintosh")>=0&&ee()&&!(navigator.userAgent.indexOf("iPhone")>=0)||navigator.userAgent.indexOf("Android")>=0||ee()}catch(e){return!1}}function Y(){return K()===H.IE&&!function(){if(K()!==H.IE)return!1;if(null==document.documentMode||void 0===document.documentMode)return!1;return document.documentMode>=11}()}function ee(){return navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}!function(e){e[e.Firefox=0]="Firefox",e[e.Opera=1]="Opera",e[e.IE=2]="IE",e[e.Edge=3]="Edge",e[e.Chrome=4]="Chrome",e[e.Safari=5]="Safari",e[e.Unknown=6]="Unknown"}(H||(H={})),function(e){e.bootWithoutWopiInfo="",e.unifiedSingleFlush="Unified_SingleFlush",e.unifiedIrmEnabled="Unified_IrmEnabled",e.unifiedViewActionUrl="Unified_ViewActionUrl",e.unifiedNotEditOrViewActionUrl="Unified_NotEditOrViewActionUrl",e.forceSingleStepBoot="Force_SingleStepBoot",e.wordUiEmbedReadOnlyEarlyRedirect="WordUiEmbed_ReadOnlyEarlyRedirect",e.wordUiEmbedIrmEnabledEarlyRedirect="WordUiEmbed_IrmEnabledEarlyRedirect"}(k||(k={}));var te,ie,oe,ne=!1,se=!1;function re(){ne=!1}function ae(e,t,i,o,n,a){if(t.ULS.traceTag(595714433,B.WopiPendingApplication,g.Info,"Starting disposing the application. unloadApp:"+e+"; disposed:"+ne+"; unloading:"+se),ne||se&&e)t.ULS.traceTag(595714908,B.WopiPendingApplication,g.Info,"Application is already disposed or unloading");else{var c,p={logger:t,postMessenger:i,innerApplicationFrame:o,onDisposed:n,unloadTimeoutInMs:a||Ee,forceAppUnload:!1,disposeStartTime:Date.now(),appUnloadTimedOut:!1};if(e&&o)return se=!0,p.forceAppUnload=!0,(c=p).forceAppUnloadStartTime=Date.now(),c.logger.ULS.traceTag(595855490,B.WopiPendingApplication,g.Info,"Sending postmessage to unload app"),c.logger.ULS.flush(),c.postMessenger.registerMessagePayloadHandler(s.Unloaded,(function(e){return function(e,t){e.forceAppUnloadEndTime=Date.now(),e.appUnloadedMessageValues=t,e.logger.ULS.traceTag(595855491,B.WopiPendingApplication,g.Info,"AppUnloaded received from app"),ce(e)}(c,e)})),c.postMessenger.sendPostMessage(c.innerApplicationFrame.contentWindow,r.Unload,{}),void window.setTimeout((function(){return function(e){!se&&ne||(e.appUnloadTimedOut=!0,e.logger.ULS.traceTag(595855492,B.WopiPendingApplication,g.Info,"ApplicationUnload timed out, forcing dispose"),ce(e))}(c)}),c.unloadTimeoutInMs);ce(p)}}function ce(e){if(!ne)try{ne=!0,se=!1,function(e){if(!e.innerApplicationFrame)return;e.innerApplicationFrame.src="about:blank",window.setTimeout((function(){e.innerApplicationFrame&&e.innerApplicationFrame.parentElement&&e.innerApplicationFrame.parentElement.removeChild(e.innerApplicationFrame)}),0)}(e),function(e){var t={disposeStartTime:e.disposeStartTime,disposeEndTime:Date.now(),forceAppUnload:e.forceAppUnload,appUnloadTimedOut:e.appUnloadTimedOut};e.forceAppUnloadStartTime&&(t.appUnloadStartTime=e.forceAppUnloadStartTime);e.forceAppUnloadEndTime&&(t.appUnloadEndTime=e.forceAppUnloadEndTime);if(e.appUnloadedMessageValues){var i=e.appUnloadedMessageValues;void 0!==i.sendBeaconFlight&&(t.sendBeaconFlight=i.sendBeaconFlight),void 0!==i.sendBeaconSupported&&(t.sendBeaconSupported=i.sendBeaconSupported);var o=Number(i.hostMessageReceived);e.forceAppUnloadStartTime&&!isNaN(o)&&(t.hostToAppPostMessageLatency=o-e.forceAppUnloadStartTime);var n=Number(i.appMessageSent);!isNaN(n)&&e.forceAppUnloadEndTime&&(t.appToHostPostMessageLatency=e.forceAppUnloadEndTime-n);var s=Number(i.appUnloadStart),r=Number(i.appUnloadEnd);if(isNaN(s)||isNaN(r)||(t.appUnloadLatency=r-s),i.serverTimings){var a=i.serverTimings;for(var c in a)t["st-"+c.toString()]=a[c]}}e.logger.ULS.traceTag(595855436,B.WopiPendingApplication,g.Info,"App disposed "+JSON.stringify(t)),e.logger.ULS.flushOnClose()}(e),e.onDisposed&&e.onDisposed()}catch(t){e.logger.ULS.traceTag(595714434,B.WopiPendingApplication,g.Error,"Error disposing: "+T(t))}}var pe;function le(e,t){te||(te=function(){var e=function(){0;var e=window.ExcelSettings;return ue(e)?e:void 0}(),t=function(){try{if(!window||!window.localStorage||!window.localStorage.getItem("ExcelSettings"))return;var e=window.localStorage.getItem("ExcelSettings"),t=JSON.parse(e);return ue(t)?t:void 0}catch(e){return void(oe&&oe.ULS.traceTag(595616212,B.WopiPendingApplication,g.Error,"Failed to get settings from localStorage: "+T(e)))}}();if(e&&t)return parseInt(e.timestamp,10)>parseInt(t.timestamp,10)?e:t;return t||e}()),!oe&&t&&(oe=t),e&&!ie&&(ie=setTimeout(ge,3e4,e))}function de(e,t){if(le(),!te||!te.hasOwnProperty(e))return t;var i=te[e],o=typeof t;if(typeof i===o)return i;if("string"==typeof i){if("number"===o)return parseInt(i,10);if("boolean"===o)return"true"===i}return t}function ge(e){if(ne)return clearTimeout(ie),void(ie=void 0);var t=new XMLHttpRequest;t.open("GET",e+"AppSettingsHandler.ashx?app=Excel"),t.responseType="json",t.timeout=5e3,t.send(),t.onload=function(){200===t.status&&t.response&&(!function(e){if(!ue(e))return;if(te=e,!window||!window.localStorage)return;var t=JSON.stringify(e);try{window.localStorage.setItem("ExcelSettings",t)}catch(e){oe&&oe.ULS.traceTag(595616214,B.WopiPendingApplication,g.Error,"Failed to set localStorage: "+T(e))}}(t.response),ie=setTimeout(ge,de(pe.SettingsFetchPeriod,6e4),e))}}function ue(e){if(e&&"object"==typeof e){if(e.hasOwnProperty("timestamp")&&!isNaN(e.timestamp))return!0;oe&&oe.ULS.traceTag(595616215,B.WopiPendingApplication,g.Error,"Received invalid settings")}return!1}function fe(e,t,i){void 0===i&&(i=!1);var o=e.applicationUrl;e.wopiPrecheckInfo.IsNewFile&&o.replace("unified=1","edit=1&new=1");var n={jsApi:"1"};if(i&&(n.NewSession="1"),n.corrid=e.sessionId,n.usid=e.sessionId,(e.applicationCustomSettings&&e.applicationCustomSettings.IsCore||e.sessionInformation.IsCore)&&(n.core="1"),e.sessionInformation.HideViewerToolbar&&(n.hvt="1"),e.sessionInformation.DisableFocusOnBoot&&(n.disableFocusOnBoot="1"),e.sessionInformation.HighContrastMode&&(n.hcm=encodeURIComponent(e.sessionInformation.HighContrastMode)),e.sessionInformation.SupportsAccessibilityLoop&&(n.accloop="1"),e.sessionInformation.SupportsDocReboot){var s=e.sessionInformation.SupportsDocReboot;n.sdr=!0===s?"1":s.toString()}return e.sessionInformation.SupportsCreateNewDocument&&(n.scnd="1"),e.sessionInformation.HideHeader&&(n.hhdr="1"),e.applicationCustomSettings&&e.applicationCustomSettings.FixDiagnosticsJson&&(n.fixdiag="1"),e.wopiPrecheckInfo.ReadOnly&&(n.readOnly="1"),e.sessionInformation.UIEmbed&&(n.uiEmbed="1"),e.applicationCustomSettings&&e.applicationCustomSettings.InAppDocumentPreview&&(n.InAppDocPreview="1"),t.isSingleStepBoot?(t.bootFlowType===k.unifiedSingleFlush&&(e.isCreateNew||(n.instantedit="1",n.wopicomplete="1")),n.wdRedirectionReason=t.bootFlowType):(n.instantedit="1",n.fileSrc=encodeURIComponent(e.sessionInformation.HostName),n.pmOrigin=encodeURIComponent(_(window.location.href)),e.isCreateNew&&(n.new="1",e.wopiPrecheckInfo.IsNewFileFromHostTemplate&&(n.wdTpl="fromhost"))),e.wopiPrecheckInfo.PreseededSessionKey&&(n.preseededSessionKey=encodeURIComponent(e.wopiPrecheckInfo.PreseededSessionKey)),e.wopiPrecheckInfo.PreseededWacSessionId&&(n.preseededWacSessionId=encodeURIComponent(e.wopiPrecheckInfo.PreseededWacSessionId)),function(e){var t=e.featureManager&&e.featureManager.isFeatureEnabled(O.InstantShell),i=e.applicationUrl;return(R(i)||L(i))&&de(pe.ExcelInstantShellEnabled,!1)||t;return!1}(e)&&(n.instantshell="1"),e.applicationCustomSettings&&e.applicationCustomSettings.additionalApplicationParameters&&(n=I(I({},e.applicationCustomSettings.additionalApplicationParameters),n)),e.rebootOverrideData&&e.rebootOverrideData.queryOverrides&&(n=I(I({},n),e.rebootOverrideData.queryOverrides)),function(e,t,i,o,n){var s=function(e){var t={},i=e.indexOf("?");return-1===i||i===e.length-1||e.substring(i+1).replace(new RegExp(/<.*?>/g),"").split("&").forEach((function(e){if(e){var i=e.indexOf("=");-1!==i&&i!==e.length-1&&(t[e.substring(0,i).toLowerCase()]=e.substring(i+1))}})),t}(e);"teams"!==s.uih&&"owa"!==s.uih||(s.hhdr="1");var r=e.indexOf("?"),a=-1===r?e.concat("?"):e.substring(0,r+1);t.UiLocale&&(s.ui=encodeURIComponent(t.UiLocale));t.DataLocale&&(s.rs=encodeURIComponent(t.DataLocale));t.HostSessionId&&(s.hid=encodeURIComponent(t.HostSessionId));t.DisableChat&&(s.dchat="1");t.SessionContext&&(s.sc=encodeURIComponent(t.SessionContext));i&&i.WopiSrc&&(s.wopisrc=encodeURIComponent(i.WopiSrc));t.CookieCompliant&&(s.mscc="1");o&&(o.entryPoint&&(s.wdorigin=encodeURI(o.entryPoint)),o.userClickTime&&(s.wdhostclicktime=o.userClickTime.toString()));s=I(I(I({},s),t.WdParams),n);var c={};for(var p in s)c[p.toLowerCase()]=s[p];var l=[];for(var p in c)c[p]&&l.push(p.concat("=",c[p]));return a.concat(l.join("&"))}(o,e.sessionInformation,e.wopiInfo,e.diagnostics.HostInitializeDiagnostics,n)}function he(e){return e.AccessTokenExpiry?e.AccessTokenExpiry.getTime().toString():"0"}!function(e){e.ExcelInstantShellEnabled="ExcelInstantShellEnabled",e.SettingsFetchPeriod="BootstrapperSettingsFetchPeriod"}(pe||(pe={}));var me,we,Se,ve,Ie,ye,Te=!1,Ae=!1,Fe=["xlviewerinternal.aspx","xlembed.aspx"],Ce=0;function Pe(e,t,i){Se=e,ve=t,ye=i,We(),setTimeout((function(){!function e(){if(Ce>=3)return void Se.ULS.traceTag(595350870,B.WopiPendingApplication,g.Info,"ExcelLandingPageObserver: checkFirstFlushArrived  Max Limit reached for retry attempts3");if(We(),Te)setTimeout((function(){(!Ae||Ce>0)&&Se.ULS.traceTag(595350872,B.WopiPendingApplication,g.Info,"ExcelLandingPageObserver: checkSecondFlushArrived Second Flush status: "+Ae+" after first flush retry attempt: "+Ce)}),we);else{if(Ce+=1,Se.ULS.traceTag(595350871,B.WopiPendingApplication,g.Info,"ExcelLandingPageObserver: checkFirstFlushArrived  Retry Request: "+Ce),ye.isFeatureEnabled(O.ExcelLandingPageObserverRetry)&&1===Ce)document.getElementById(ve).submit();setTimeout((function(){e()}),me)}}()}),me),Se.ULS.traceTag(594622165,B.WopiPendingApplication,g.Info,"ExcelLandingPageObserver:initExcelLandingPageObserver called")}function We(){me=3750,we=6e3;var e=function(){if(window&&window.navigator){var e=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection;return e?e.effectiveType:void 0}}();if(void 0!==e)switch(void 0!==Ie&&Ie!==e&&Se.ULS.traceTag(595350873,B.WopiPendingApplication,g.Info,"ExcelLandingPageObserver: initializeTimeOutIntervals previousConnection: "+Ie+" currentConnection: "+e+" First Flush: "+Te+" Second Flush:"+Ae),Ie=e,e){case"4g":me=3750,we=6e3;break;case"3g":me=5e3,we=8e3;break;case"2g":me=1e4,we=24e3;break;case"slow-2g":me=2e4,we=4e4}}var Ue,Ee=1e3;function be(e,t,i,o,n,s,r){var a=function(e,t,i,o,n){var s=e.ownerDocument.createElement("iframe");s.name=o||"WebApplicationFrame",s.id="WebApplicationFrame",s.src="",s.title="Office Online Frame",s.width="100%",s.height="100%",s.marginWidth="0",s.marginHeight="0",s.style.left="0",s.style.top="0",s.style.right="0",s.style.bottom="0",s.style.display="block",s.style.position="absolute",s.style.backgroundColor="transparent",s.style.border="none",s.frameBorder="0",s.setAttribute("allowfullscreen","true"),s.setAttribute("allowTransparency","true"),i&&s.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups allow-top-navigation allow-popups-to-escape-sandbox");var r=_(t);return s.setAttribute("allow","microphone "+r+"; camera "+r+";"),n&&(s.onload=n),e.appendChild(s),s}(e,t,o,n);return function(e){return Fe.some((function(t){return-1!==e.indexOf(t)}))}(t)&&Pe(s,"office_form",r),function(e,t,i,o){!function(e,t){t[Ue.wacFrameComputedHeightPx]=String(e.offsetHeight),t[Ue.wacFrameComputedWidthPx]=String(e.offsetWidth),t[Ue.wacFrameTouchMode]=String(Q()),t[Ue.wacFrameHighContrast]=String(function(){try{return window.matchMedia("screen and (-ms-high-contrast: active)").matches}catch(e){return!1}}()),t[Ue.wacFrameForceSLR]=String(window.external&&window.external.getHostEnvironmentValue&&'{"os-sku":"189"}'===window.external.getHostEnvironmentValue("os-sku"))}(e,o);var n=t.ownerDocument,s=n.createElement("form");for(var r in s.id="office_form",s.name="office_form",s.action=i,s.target=e.name,s.method="POST",o){var a=n.createElement("input");a.type="hidden",a.name=r,a.value=o[r],s.appendChild(a)}return t.appendChild(s),s.submit(),e}(a,e,t,i)}function Oe(e,t){var i={};if(e.wopiInfo&&(i[Ue.wacFrameAccessToken]=e.wopiInfo.AccessToken,i[Ue.wacFrameAccessTokenTtl]=he(e.wopiInfo)),e.wopiPrecheckInfo.BundleInfo&&e.wopiPrecheckInfo.BundleInfo.Url&&e.wopiPrecheckInfo.BundleInfo.Url.length>0)if(i[Ue.wacFrameBundleSource]=e.wopiPrecheckInfo.BundleInfo.Url,null!=e.wopiPrecheckInfo.BundleInfo.BundleStaleness&&void 0!==e.wopiPrecheckInfo.BundleInfo.BundleStaleness){var o=e.wopiPrecheckInfo.BundleInfo.BundleStaleness.toString();t.ULS.traceTag(593503580,B.WopiPendingApplication,g.Info,"Content bundle staleness - "+o),i[Ue.wacFrameBundleStaleness]=o}else t.ULS.traceTag(593503581,B.WopiPendingApplication,g.Info,"Content bundle staleness does not exist");if(e.wopiPrecheckInfo.FileGetUrl&&(i[Ue.wacFrameFileGetUrl]=e.wopiPrecheckInfo.FileGetUrl),e.wopiPrecheckInfo.FileName){var n=e.wopiPrecheckInfo.FileName.lastIndexOf(".");if(-1!==n){var s=e.wopiPrecheckInfo.FileName.substring(n+1);s&&(i[Ue.wacFrameFileExtension]=s)}i[Ue.wacFrameFileName]=e.wopiPrecheckInfo.FileName}return e.newFileTemplateSource&&e.newFileTemplateSource.FileSize?i[Ue.wacFrameFileSize]=e.newFileTemplateSource.FileSize.toString():e.wopiPrecheckInfo.FileSize&&(i[Ue.wacFrameFileSize]=e.wopiPrecheckInfo.FileSize.toString()),e.sessionInformation.UserId&&(i[Ue.wacFrameUserId]=e.sessionInformation.UserId),e.sessionInformation.OwnerId&&(i[Ue.wacFrameOwnerId]=e.sessionInformation.OwnerId),e.sessionInformation.SessionContext&&(i[Ue.wacFrameSessionContext]=e.sessionInformation.SessionContext),e.diagnostics&&(i[Ue.wacFrameHostDiagnostics]=JSON.stringify(e.diagnostics)),i[Ue.wacFrameFeatureStatus]=function(e,t){var i={};if(e)for(var o in O){var n=e.isFeatureEnabled(o);void 0!==n&&(i[o]=n?"1":"0")}if(t&&t.wdFlights)for(var s=t.wdFlights.toLowerCase(),r=0,a=s.split(",");r<a.length;r++){var c=a[r];"et-treatment"!==c&&"et-control"!==c||(i[O.EnterpriseTemplates]="et-treatment"===c?"1":"0")}return JSON.stringify(i)}(e.featureManager,e.sessionInformation.WdParams),e.applicationCustomSettings&&e.applicationCustomSettings.HostUIControls&&(i[Ue.wacFrameHostUIControlOverrides]=JSON.stringify(e.applicationCustomSettings.HostUIControls)),i[Ue.wacFrameHighDpi]=String(window.devicePixelRatio>1.24),i[Ue.wacSoftBlockedBrowser]=String(Y()),i[Ue.wacFrameHostName]=e.sessionInformation.HostName,e.newFileTemplateSource&&(i[Ue.wacFrameTemplateUrl]=e.newFileTemplateSource.FileGetUrl),e.newFileTemplateSource&&e.newFileTemplateSource.DocUniqueId?i[Ue.wacFrameDocID]=e.newFileTemplateSource.DocUniqueId:e.wopiPrecheckInfo.DocUniqueId&&(i[Ue.wacFrameDocID]=e.wopiPrecheckInfo.DocUniqueId),e.newFileTemplateSource&&e.newFileTemplateSource.ETag?i[Ue.wacFrameETag]=e.newFileTemplateSource.ETag:e.wopiPrecheckInfo.ETag&&(i[Ue.wacFrameETag]=e.wopiPrecheckInfo.ETag),i}!function(e){e.wacFrameAccessToken="access_token",e.wacFrameAccessTokenTtl="access_token_ttl",e.wacFrameBundleSource="bundleSrc",e.wacFrameBundleStaleness="bundleStaleness",e.wacFrameFileGetUrl="fileGetUrl",e.wacFrameFileExtension="fileExtension",e.wacFrameFileSize="fileSize",e.wacFrameFileName="fileName",e.wacFrameOwnerId="owner_id",e.wacFrameUserId="user_id",e.wacFrameSessionContext="sc",e.wacFrameHostDiagnostics="host_diagnostics",e.wacFrameHighDpi="highDpi",e.wacFrameComputedHeightPx="frameHeightPx",e.wacFrameComputedWidthPx="frameWidthtPx",e.wacFrameHostFlights="hostFlights",e.wacFrameHighContrast="highContrast",e.wacFrameTouchMode="touchMode",e.wacFrameHostUIControlOverrides="huictrls",e.wacSoftBlockedBrowser="softBlockedBrowser",e.wacFrameHostName="hostName",e.wacFrameFeatureStatus="feature_status",e.wacFrameTemplateUrl="templateUrl",e.wacFrameETag="ETag",e.wacFrameDocID="DocID",e.wacFrameForceSLR="forceSLR"}(Ue||(Ue={}));var Me=function(){function e(e,t,i,o,n,s,r,a){if(this.wacAppCompleteOrFailReceived=!1,this.ulsHeartBeatTimer=void 0,this.logTimers=[],void 0===t)throw new TypeError("bootFlowInfo");if(t.isSingleStepBoot&&void 0===e.wopiInfo)throw new TypeError("wopiInfo");this.appParams=e,this.bootFlowInfo=t,this.logger=n,this.postMessenger=s,this.fnOnWopiBootSuccess=r,this.fnOnWopiBootFailure=a,this.appInitDiagnostics=i,this.sessionTraces=o,this.sessionTraces.wopiInitializeTime=Date.now()}return e.prototype.Boot=function(){var e=this;this.logger.ULS.traceTag(596444241,B.WopiPendingApplication,g.Info,"Initializing WAC frame");var t=fe(this.appParams,this.bootFlowInfo,!0),i=Oe(this.appParams,this.logger);if(this.beginUlsHeartBeat(R(t)?3e3:5e3),this.postMessenger.registerMessagePayloadHandler(s.BootState,(function(t){e.handleWacAppBootState(t)})),this.postMessenger.registerMessagePayloadHandler(s.TrustFrame,(function(t){e.handleTrustFrameRequest(t)})),this.bootFlowInfo.ignoreWacFramePostMessages||this.populateWacFrameCompletedAndFailedHandlers(),this.bootWacFrame(t,i),this.bootFlowInfo.ignoreWacFramePostMessages){var o=this.getApplicationState();this.fnOnWopiBootSuccess(o)}return this.logger.ULS.traceTag(595661019,B.WopiPendingApplication,g.Info,"Created Wac Frame"),this.innerApplicationFrame},e.prototype.bootWacFrame=function(e,t){this.appInitDiagnostics.officeFrameCreateTime=Date.now(),this.sessionTraces.frameCreateStartTime=this.appInitDiagnostics.officeFrameCreateTime;var i=!(!this.appParams.sessionInformation.WdParams||!this.appParams.sessionInformation.WdParams.wdSandboxWacFrame),o=this.appParams.applicationCustomSettings&&this.appParams.applicationCustomSettings.appFrameName;this.innerApplicationFrame=be(this.appParams.container,e,t,i,o,this.logger,this.appParams.featureManager),this.postMessenger.activate(this.innerApplicationFrame)},e.prototype.populateWacFrameCompletedAndFailedHandlers=function(){var e=this;this.postMessenger.registerMessagePayloadHandler(s.BootSucceeded,(function(t){e.handleWacCompleteMessage(t)})),this.postMessenger.registerMessagePayloadHandler(s.BootFailed,(function(t){e.handleWacFailureMessage(t)})),this.logTimers.push(window.setTimeout((function(){return e.timeoutWacAppCompleteOrFail()}),15e3)),this.logTimers.push(window.setTimeout((function(){return e.logWarningOnNoAppComplete(1)}),6e4)),this.logTimers.push(window.setTimeout((function(){return e.logWarningOnNoAppComplete(2)}),18e4))},e.prototype.handleWacAppBootState=function(e){var t=e&&e.state?e.state:"unknown";this.logger.ULS.traceTag(595714271,B.WopiPendingApplication,g.Info,"WAC Boot App state:["+t+"]"),function(e){"PageLoadSkeleton Presented"===e?Te=!0:"BootstapContext Recieved"===e&&(Ae=!0)}(t)},e.prototype.handleTrustFrameRequest=function(e){var t=window===window.top||window.parent===window.top&&window.location.origin===window.top.origin;this.logger.ULS.traceTag(595653903,B.WopiPendingApplication,g.Info,"Top frame is trusted: "+t),this.postMessenger.sendPostMessage(this.innerApplicationFrame.contentWindow,r.TrustFrame,{isTopFrameTrusted:t})},e.prototype.handleWacCompleteMessage=function(e){if(this.logger.ULS.traceTag(595986314,B.WopiPendingApplication,g.Info,"Received wac complete message"),this.logger.ULS.flush(),this.endUlsHeartBeat(),this.clearLogTimers(),this.wacAppCompleteOrFailReceived)this.logger.ULS.traceTag(596444234,B.WopiPendingApplication,g.Info,"Received multiple wac complete or failure messages");else{this.wacAppCompleteOrFailReceived=!0,this.sendWacPostMessage(r.BootSucceededAck,{}),J(this.appInitDiagnostics,e);var t=this.getApplicationState();this.fnOnWopiBootSuccess(t),this.sendJsApiDiagnosticsToWacFrame(this.appParams.diagnostics)}},e.prototype.getApplicationState=function(){return{innerApplicationFrame:this.innerApplicationFrame}},e.prototype.handleWacFailureMessage=function(e){if(this.logger.ULS.traceTag(595986315,B.WopiPendingApplication,g.Error,"Received wac failed message"),this.logger.ULS.flush(),this.endUlsHeartBeat(),this.clearLogTimers(),this.wacAppCompleteOrFailReceived)this.logger.ULS.traceTag(596444235,B.WopiPendingApplication,g.Info,"Received multiple wac complete or failure messages");else{this.wacAppCompleteOrFailReceived=!0,this.sendWacPostMessage(r.BootFailedAck,{});var t={errorType:M.WacFailed,errorObject:{}};e&&(t.errorObject=e.Error,this.sessionTraces.error=t),this.fnOnWopiBootFailure(t)}},e.prototype.timeoutWacAppCompleteOrFail=function(){this.wacAppCompleteOrFailReceived||this.logger.ULS.traceTag(596444236,B.WopiPendingApplication,g.Warning,"Timeout. SessionTraces:"+JSON.stringify(this.sessionTraces))},e.prototype.clearLogTimers=function(){for(var e=0;e<this.logTimers.length;e+=1)this.logTimers[e]&&window.clearTimeout(this.logTimers[e]);this.logTimers=[]},e.prototype.logWarningOnNoAppComplete=function(e){this.wacAppCompleteOrFailReceived||(this.logger.ULS.traceTag(594901218,B.WopiPendingApplication,g.Warning,"Boot_NotComplete_"+(e||"Final")),this.logger.ULS.flush())},e.prototype.sendJsApiDiagnosticsToWacFrame=function(e){this.sendWacPostMessage(r.JsApiDiagnostics,e)},e.prototype.beginUlsHeartBeat=function(e){var t=this;this.ulsHeartBeatStart=Date.now(),this.ulsHeartBeatTimer=window.setInterval((function(){t.logger.ULS.traceTag(595724178,B.WopiPendingApplication,g.Info,"Boot_HeartBeat"),Date.now()-t.ulsHeartBeatStart>3e5&&(t.logWarningOnNoAppComplete(),t.endUlsHeartBeat())}),e)},e.prototype.endUlsHeartBeat=function(){this.ulsHeartBeatTimer&&(window.clearInterval(this.ulsHeartBeatTimer),this.ulsHeartBeatTimer=void 0)},e.prototype.sendWacPostMessage=function(e,t){this.innerApplicationFrame&&this.innerApplicationFrame.contentWindow?this.postMessenger.sendPostMessage(this.innerApplicationFrame.contentWindow,e,t):this.logger.ULS.traceTag(595955718,B.WopiPendingApplication,g.Info,"Attempted to send postmessage: "+e)},e}();var Re,Le=function(){function e(e,t,i,o,n,s,r,a,c){var p=this;this.wacFrameIsLoaded=!1,this.initializeCompleted=!1,this.completeOrFailCalled=!1,this.sessionFailureReason=null,this.parallelizeStartSession=!0,this.wacAcceptsStartSessionComplete=!1,this.wacAppSessionCompletionMessageAck=!1,this.appParams=e,this.bootFlowInfo=t,this.appInitDiagnostics=i,this.logger=o,this.postMessenger=n,this.fnOnWopiBootSuccess=a,this.fnOnWopiBootFailure=c,this.sessionTraces=s,this.sessionTraces.wopiPendingInitializeTime=Date.now(),this.cleanup=r,re(),window.setTimeout((function(){return p.timeoutCompleteOrFail()}),5e3)}return e.prototype.Complete=function(e,t){if(this.completeOrFailCalled)this.logger.ULS.traceTag(596444184,B.WopiPendingApplication,g.Warning,"Complete called after Complete/Fail already called");else{this.logger.ULS.traceTag(596444185,B.WopiPendingApplication,g.Info,"Complete called."),this.completeOrFailCalled=!0,this.wopiInfo=e,this.sessionTraces.wopiPendingCompleteTime=Date.now();try{this.bootFlowInfo.isSingleStepBoot?this.completeSingleStepFlow():this.completeTwoStepFlow(),this.wacFrameIsLoaded&&this.sendWacPostMessage(r.PendingAppCompleteReceived,{}),this.updateBrowserHistoryForCreateNew(t)}catch(e){this.logger.ULS.traceTag(596444186,B.WopiPendingApplication,g.Error,"Unexpected script error: "+T(e))}finally{this.logger.ULS.flush()}}},e.prototype.Fail=function(e){this.completeOrFailCalled?this.logger.ULS.traceTag(596444187,B.WopiPendingApplication,g.Warning,"Fail called after Complete/Fail already called"):(this.logger.ULS.traceTag(596444188,B.WopiPendingApplication,g.Warning,"Fail called. Reason: "+(e?JSON.stringify(e):"N/A")),this.completeOrFailCalled=!0,this.bootFlowInfo.isSingleStepBoot?this.failSingleStepFlow():this.failTwoStepFlow(e),this.logger.ULS.flush())},e.prototype.Dispose=function(e,t,i){var o=this;ae(e||!1,this.logger,this.postMessenger,this.innerApplicationFrame,(function(){delete o.innerApplicationFrame,t&&t(),o.cleanup(),o.postMessenger.dispose()}),i)},e.prototype.Boot=function(){this.bootFlowInfo.isSingleStepBoot||this.bootTwoStepFlow(),this.logger.ULS.flush()},e.prototype.bootTwoStepFlow=function(){var e=this;this.logger.ULS.traceTag(596444231,B.WopiPendingApplication,g.Info,"Initializing Office frame WITHOUT WOPI info - first step of two step flow."),window.setTimeout((function(){return e.timeoutWacReadyMessage()}),5e3),this.populateWacFrameEventHandlersForTwoStepFlow();var t=new Me(this.appParams,this.bootFlowInfo,this.appInitDiagnostics,this.sessionTraces,this.logger,this.postMessenger,this.fnOnWopiBootSuccess,this.fnOnWopiBootFailure);this.innerApplicationFrame=t.Boot()},e.prototype.populateWacFrameEventHandlersForTwoStepFlow=function(){var e=this;this.postMessenger.registerMessagePayloadHandler(s.InitReady,(function(t){e.handleWacReadyMessage(t)})),this.postMessenger.registerMessagePayloadHandler(s.InitFrameLoaded,(function(t){e.handleWacFrameLoadedMessage(t)})),this.postMessenger.registerMessagePayloadHandler(s.SessionCompleteAck,(function(t){e.handleWacFrameSessionCompleteAckMessage(t)}))},e.prototype.completeTwoStepFlow=function(){var e={ParallelizeStartSession:this.parallelizeStartSession,WacFrameIsLoaded:this.wacFrameIsLoaded,WacAcceptsStartSessionComplete:this.wacAcceptsStartSessionComplete};this.logger.ULS.traceTag(596444232,B.WopiPendingApplication,g.Info,"Completing the initialized application WITH the WOPI info - second step of two step flow. Current app state - "+JSON.stringify(e)),!this.parallelizeStartSession||this.wacFrameIsLoaded&&!this.wacAcceptsStartSessionComplete?this.wacFrameIsLoaded&&this.sendWopiInfoToWacFrame():this.makeStartSessionRequest()},e.prototype.completeSingleStepFlow=function(){this.logger.ULS.traceTag(596444233,B.WopiPendingApplication,g.Info,"Initializing Office frame WITH WOPI info - single step WOPI boot flow."),this.appParams.wopiInfo=this.wopiInfo;var e=new Me(this.appParams,this.bootFlowInfo,this.appInitDiagnostics,this.sessionTraces,this.logger,this.postMessenger,this.fnOnWopiBootSuccess,this.fnOnWopiBootFailure);this.innerApplicationFrame=e.Boot()},e.prototype.failTwoStepFlow=function(e){this.wacFrameIsLoaded?(this.logger.ULS.traceTag(595968481,B.WopiPendingApplication,g.Warning,"Fail called and wacframe is able to accept postmessages"),this.sendFailurePostMessageToWacFrame(e)):(this.logger.ULS.traceTag(595968482,B.WopiPendingApplication,g.Warning,"Fail was called on the session prior to WacReady."),this.sessionFailureReason=e)},e.prototype.sendFailurePostMessageToWacFrame=function(e){this.logger.ULS.traceTag(596444189,B.WopiPendingApplication,g.Warning,"Fail called, sending the failure postmessage to IFrame"),this.sendWacPostMessage(r.FailSession,e)},e.prototype.failSingleStepFlow=function(){this.logger.ULS.traceTag(596444190,B.WopiPendingApplication,g.Warning,"Fail called during single step boot, calling host failure callback..."),this.fnOnWopiBootFailure({errorType:M.InvalidWopiInfo,errorObject:new TypeError("wopiInfo")})},e.prototype.timeoutWacReadyMessage=function(){this.wacFrameIsLoaded||(this.logger.ULS.traceTag(596444191,B.WopiPendingApplication,g.Warning,"Timeout Wac Ready"),this.fnOnWopiBootFailure({errorType:M.TimeoutWacReady,errorObject:void 0}))},e.prototype.timeoutCompleteOrFail=function(){this.completeOrFailCalled||(this.sessionTraces.timeoutCompleteOrFail=Date.now(),this.logger.ULS.traceTag(596444192,B.WopiPendingApplication,g.Warning,"Timeout Complete or Fail. SessionTraces:"+JSON.stringify(this.sessionTraces)))},e.prototype.timeoutWacSessionCompletionMessageAck=function(e,t,i){this.wacAppSessionCompletionMessageAck||(this.logger.ULS.traceTag(596444193,B.WopiPendingApplication,g.Info,"SessionCompletion timed out with no ack."),this.sendSessionCompletionMessageWithRetryHelper(e,t,i+1))},e.prototype.handleWacReadyMessage=function(e){if(this.sessionTraces.readyMessageReceiveTime=Date.now(),this.sendWacPostMessage(r.InitReadyAck,{}),this.wacFrameIsLoaded)this.logger.ULS.traceTag(596444194,B.WopiPendingApplication,g.Info,"Received multiple ready messages - frame is already loaded.");else{this.wacFrameIsLoaded=!0,this.wacAcceptsStartSessionComplete=e&&e.CanAcceptStartSessionComplete;var t={AcceptStartSessionComplete:this.wacAcceptsStartSessionComplete,ParallelizeStartSession:this.parallelizeStartSession,StartSessionResponse:null!=this.startSessionResponse,WopiInfo:null!=this.wopiInfo};this.logger.ULS.traceTag(596444195,B.WopiPendingApplication,g.Info,"HandleWacReadyMessage - "+JSON.stringify(t)),this.completeOrFailCalled&&(this.sessionFailureReason?this.sendFailurePostMessageToWacFrame(this.sessionFailureReason):this.sendWacPostMessage(r.PendingAppCompleteReceived,{})),this.parallelizeStartSession&&this.wacAcceptsStartSessionComplete?this.startSessionResponse&&this.startSessionCompleted():this.wopiInfo&&this.sendWopiInfoToWacFrame(),J(this.appInitDiagnostics,e)}},e.prototype.handleWacFrameLoadedMessage=function(e){J(this.appInitDiagnostics,e)},e.prototype.handleWacFrameSessionCompleteAckMessage=function(e){this.wacAppSessionCompletionMessageAck=!0,this.sessionTraces.sessionCompleteAckReceivedTime=Date.now()},e.prototype.sendWacPostMessage=function(e,t){this.innerApplicationFrame&&this.postMessenger.sendPostMessage(this.innerApplicationFrame.contentWindow,e,t)},e.prototype.sendSessionCompletionMessageWithRetry=function(e,t){this.sendSessionCompletionMessageWithRetryHelper(e,t,1)},e.prototype.sendSessionCompletionMessageWithRetryHelper=function(e,t,i){var o=this;if(i>3)this.logger.ULS.traceTag(596444224,B.WopiPendingApplication,g.Error,"Attempted to call complete, but received no ack from the frame. Time: "+Date.now());else{this.logger.ULS.traceTag(596444225,B.WopiPendingApplication,g.Info,"Sending completion message to frame. Attempt number: "+i+", Time: "+Date.now());var n=Date.now();1===i&&(this.startSessionResponse&&this.startSessionResponse.Diagnostics&&(this.startSessionResponse.Diagnostics.completeMessageCreateTime=n),this.sessionTraces.completeMessageCreateTime=n),t.Diagnostics.completeMessageSendTime=n,this.sessionTraces.completeMessageSendTime=n,this.sendWacPostMessage(e,t),window.setTimeout((function(){return o.timeoutWacSessionCompletionMessageAck(e,t,i)}),1e3)}},e.prototype.makeStartSessionRequest=function(){var e=this;this.logger.ULS.traceTag(596444226,B.WopiPendingApplication,g.Info,"Making parallelized startSession request.");var t=this.buildStartSessionUrl(this.wopiInfo),i={"Content-Type":"application/x-www-form-urlencoded"},o="access_token="+encodeURIComponent(this.wopiInfo.AccessToken)+"&access_token_ttl="+encodeURIComponent(he(this.wopiInfo));this.sessionTraces.startSessionStartTime=Date.now(),function(e,t,i,o){var n=new XMLHttpRequest;for(var s in n.onreadystatechange=function(){if(n&&4===n.readyState){if(void 0===n.status||0===n.status)return;try{o&&o(n)}finally{null!=n&&(n.onreadystatechange=function(){})}}},n.open("POST",e),i)n.setRequestHeader(s,i[s]);n.send(t)}(t,o,i,(function(t){return e.onStartSessionRequestCompleted(t)}))},e.prototype.onStartSessionRequestCompleted=function(e){if(this.sessionTraces.startSessionCompleteTime=Date.now(),this.sessionTraces.startSessionResponseStatus=e.status,this.startSessionResponse={StartSessionResponse:{RequestStatus:e.status,ResponseText:e.responseText},Diagnostics:{wopiPendingInitializeTime:this.sessionTraces.wopiPendingInitializeTime,wopiPendingCompleteTime:this.sessionTraces.wopiPendingCompleteTime,startSessionStartTime:this.sessionTraces.startSessionStartTime,startSessionCompleteTime:this.sessionTraces.startSessionCompleteTime,readyMessageReceiveTime:this.sessionTraces.readyMessageReceiveTime}},this.logger.ULS.traceTag(596444227,B.WopiPendingApplication,g.Info,"StartSession request completed with status code: "+this.startSessionResponse.StartSessionResponse.RequestStatus+", Time: "+Date.now()),this.wacFrameIsLoaded&&this.wacAcceptsStartSessionComplete)this.startSessionCompleted();else{var t={WacFrameIsLoaded:this.wacFrameIsLoaded,InitializeCompleted:this.initializeCompleted};this.logger.ULS.traceTag(596444228,B.WopiPendingApplication,g.Info,"StartSessionCompleted not called - "+JSON.stringify(t))}},e.prototype.sendWopiInfoToWacFrame=function(){if(!this.initializeCompleted){this.initializeCompleted=!0,this.logger.ULS.traceTag(596444229,B.WopiPendingApplication,g.Info,"Sending wopi info to the frame.");var e={WopiDetails:{WopiSrc:this.wopiInfo.WopiSrc,AccessToken:this.wopiInfo.AccessToken,AccessTokenTtl:he(this.wopiInfo)},Diagnostics:{wopiPendingInitializeTime:this.sessionTraces.wopiPendingInitializeTime,wopiPendingCompleteTime:this.sessionTraces.wopiPendingCompleteTime,readyMessageReceiveTime:this.sessionTraces.readyMessageReceiveTime}};this.sendSessionCompletionMessageWithRetry(r.PendingSessionComplete,e)}},e.prototype.startSessionCompleted=function(){200===this.startSessionResponse.StartSessionResponse.RequestStatus?this.initializeCompleted||(this.initializeCompleted=!0,this.sendSessionCompletionMessageWithRetry(r.StartSessionComplete,this.startSessionResponse)):this.sendWopiInfoToWacFrame()},e.prototype.buildStartSessionUrl=function(e){var t=this.appParams.applicationBaseUrl+"wordeditorstartsession.ashx",i=fe(this.appParams,this.bootFlowInfo,!1);return t=z(t+="?"+i.substring(i.indexOf("?")+1),"WOPISrc",encodeURIComponent(e.WopiSrc)),t=z(t,"build",encodeURIComponent(b())),t=z(t,"WacUserType",encodeURIComponent("WOPI")),this.appParams.wopiPrecheckInfo.FileGetUrl&&(t=z(t,"fileGetUrlPresent","1")),t},e.prototype.updateBrowserHistoryForCreateNew=function(e){if(this.appParams.isCreateNew){if(!e||!e.NewFilePath)return void this.logger.ULS.traceTag(596444230,B.WopiPendingApplication,g.Error,"Either NewFileInfo or NewFilePath are not provided for a new file.");history.replaceState({},"",e.NewFilePath),e.UpdatedPageTitle&&(document.title=e.UpdatedPageTitle)}},e}();!function(e){e.AckExpected="ackExpected",e.ErrorObject="errorObject",e.ErrorType="errorType",e.IsDisabled="isDisabled",e.NewPageNumber="newPage",e.NewZoomLevel="newLevel",e.PageCount="pageCount"}(Re||(Re={}));var _e=function(){function e(e,t){var i=this;if(this.isActivated=!1,this.messageListener=function(e){return i.handleWacFramePostMessage(e)},this.enforceSameWindow=!1,this.isFastfood=!1,this.isMsit=!1,this.eventHandlers={},!e)throw new Error("Missing origin for PostMessageHandler");this.isFastfood=R(e),this.isMsit=L(e),this.logger=t,this.setOrigin(e)}return e.prototype.registerMessagePayloadHandler=function(e,t){if(this.eventHandlers[e])throw new Error("Duplicate registration!");this.eventHandlers[e]=t},e.prototype.removeMessageHandler=function(e){delete this.eventHandlers[e]},e.prototype.sendPostMessage=function(e,t,i){if(e){this.logger.ULS.traceTag(596464334,B.WopiPendingApplication,g.Info,"Sending message: "+t);var o={MessageId:t,SendTime:Date.now(),Values:i};this.sendPostMessageInternal(e,JSON.stringify(o),this.origin)}else this.logger.ULS.traceTag(595948308,B.WopiPendingApplication,g.Info,"Missing target for SendPostMessage")},e.prototype.activate=function(e,t){void 0===t&&(t=!1),this.innerApplicationFrame=e,this.enforceSameWindow=t,this.isActivated||(window.addEventListener("message",this.messageListener,!1),this.isActivated=!0)},e.prototype.postMessageForCommand=function(e,t,i){var o=t===n.rename?r.Rename:t===n.switchMode?r.SwitchMode:p[t].messageId;o?(this.logger.ULS.traceTag(595702598,B.WopiPendingApplication,g.Info,"Sending message "+o+" for command "+t),this.sendPostMessage(e,o,i)):this.logger.ULS.traceTag(595702599,B.WopiPendingApplication,g.Warning,"No mapping for command "+t)},e.prototype.dispose=function(){for(var e=0,t=Object.keys(this.eventHandlers);e<t.length;e++){var i=t[e];delete this.eventHandlers[i]}this.isActivated&&(window.removeEventListener("message",this.messageListener,!1),this.isActivated=!1)},e.prototype.sendAckBack=function(e,t,i){if(e){var o={MessageId:r.Ack,CorrelationId:i,SendTime:Date.now()};this.logger.ULS.traceTag(595732176,B.WopiPendingApplication,g.Info,"Sending Ack back"),e.postMessage(JSON.stringify(o),t)}else this.logger.ULS.traceTag(595736136,B.WopiPendingApplication,g.Info,"Missing target to send Ack back")},e.prototype.handleWacFramePostMessage=function(e){var t=!1,i=!0,o="",n=!1;if(this.innerApplicationFrame&&this.innerApplicationFrame.contentWindow&&(t=!0,i=e.source===this.innerApplicationFrame.contentWindow),e.origin&&(n=(o=x(e.origin,2).toLowerCase())===this.receivingDomain),!this.isFastfood&&(!this.isMsit||n&&i)||this.logger.ULS.traceTag(595730526,B.WopiPendingApplication,g.Info,"Window is available: "+t+", window is valid: "+i+", origin is valid: "+n+", expected origin: "+this.receivingDomain+", actual origin: "+o),n&&(!this.enforceSameWindow||i)){var r;try{r=JSON.parse(e.data)}catch(t){return this.logger.ULS.traceTag(596464282,B.WopiPendingApplication,g.Info,"Failed to parse event data: "+T(t)+"."),void(this.isFastfood&&this.logger.ULS.traceTag(595732175,B.WopiPendingApplication,g.Info,"string"==typeof e.data?"Length of event data: "+e.data.length+". First 200 characters of event data: "+e.data.substring(0,200):"Event data: "+JSON.stringify(e.data)))}var a=r.MessageId;if(a){this.logger.ULS.traceTag(595714715,B.WopiPendingApplication,g.Info,"Received messageId: "+a+", correlation: "+r.CorrelationId),a!==s.BootSucceeded&&a!==s.LoadingStatus||this.setOrigin(e.origin),r.Values&&r.Values[Re.AckExpected]&&this.sendAckBack(e.source,e.origin,r.CorrelationId);var c=this.eventHandlers[a];if(c){this.logger.ULS.traceTag(596464288,B.WopiPendingApplication,g.Info,"Processing message: "+a);try{c(r.Values||{})}catch(e){this.logger.ULS.traceTag(593773704,B.WopiPendingApplication,g.Error,"Handler error: "+T(e))}}else this.logger.ULS.traceTag(596464289,B.WopiPendingApplication,g.Info,"No handler found for message id: "+a)}else(this.isFastfood||this.isMsit)&&this.logger.ULS.traceTag(595730520,B.WopiPendingApplication,g.Info,"Could not find message id")}},e.prototype.sendPostMessageInternal=function(e,t,i){e.postMessage(t,i)},e.prototype.setOrigin=function(e){var t=e.toLowerCase();this.origin&&this.origin!==t&&this.logger.ULS.traceTag(596128131,B.WopiPendingApplication,g.Warning,"Updating origin:"+this.origin+"->"+t),this.origin=t,this.receivingDomain=x(t,2),this.isFastfood=R(t),this.isMsit=L(t)},e}(),xe={getLogger:function(e,t){var i=C(e,{remoteUlsEndpoint:t});return{ULS:{traceTag:i.ULS.sendTraceTag,flush:i.ULS.flush,flushOnClose:i.ULS.flushOnClose}}}};var De=function(){function e(){var e=this;if(this.visibilityChangeEvents=[],this.eventHandlers=[],this.visibilityChangeHandler=function(){return e.handleVisibilityChange()},"hidden"===document.visibilityState){var t={visibility:document.visibilityState,time:Date.now(),initialState:!0};this.visibilityChangeEvents.push(t)}document.addEventListener("visibilitychange",this.visibilityChangeHandler)}return e.prototype.RegisterEventHandler=function(e){this.eventHandlers.push(e)},e.prototype.RemoveEventHandler=function(e){if(e){var t=this.eventHandlers.indexOf(e);this.eventHandlers.splice(t,1)}},e.prototype.Stop=function(){document.removeEventListener("visibilitychange",this.visibilityChangeHandler)},e.prototype.GetVisibilityChangeEvents=function(){return this.visibilityChangeEvents},e.prototype.Dispose=function(){this.Stop(),this.eventHandlers=[],this.visibilityChangeEvents=[]},e.prototype.handleVisibilityChange=function(){var e={visibility:document.visibilityState,time:Date.now(),initialState:!1};this.visibilityChangeEvents.push(e);for(var t=0,i=this.eventHandlers;t<i.length;t++){var o=i[t];o&&o(e)}},e}();var He,ke=function(){function e(e,t){this.appFactory=e,this.bootstrapperParameters=t}return e.prototype.GetVersion=function(){return b()},e.prototype.GetMinContentVersion=function(){throw new Error("Not implemented")},e.prototype.Prefetch=function(e){if(null!=e&&void 0!==e){var t=document.createElement("link");t.rel="prefetch";var i=e.BootstrapperUrl;".js"!==i.toString().slice(-3)&&(i+=".js"),t.href=i;var o=document.getElementsByTagName("head")[0];null!=o&&void 0!==o&&o.appendChild(t)}},e.prototype.InitializeWopiPending=function(e,t,i,o,n){var r,a,c,p;try{var l=Date.now();!function(e){if(void 0===e)throw new TypeError("initParams");var t=e.Container;if(void 0===t||void 0===t.appendChild)throw new TypeError("Container");var i=e.SessionInformation;if(void 0===i||void 0===i.HostName||void 0===i.HostSessionId||void 0===i.UserId)throw new TypeError("SessionInformation");var o=e.ApplicationUrl;if(void 0===o||"string"!=typeof o)throw new TypeError("ApplicationUrl");var n=e.WopiPrecheckInfo;if(void 0===n||void 0===n.FileName)throw new TypeError("WopiPrecheckInfo");if(void 0===e.FnOnInitializeSuccess)throw new TypeError("FnOnInitializeSuccess");if(void 0===e.FnOnInitializeFailure)throw new TypeError("FnOnInitializeFailure")}(e),function(e){if(e.RebootOverrideData){var t=e.RebootOverrideData.mode.toLowerCase();if("view"!==t&&"edit"!==t)throw new Error("Unknown mode in RebootOverrideData");0,e.RebootOverrideData.queryOverrides.wdforcedmode="view"===t?"View":"Edit"}}(e);var d=void 0,u=void 0;i?d=i:e.RebootOverrideData&&!e.RebootOverrideData.isNewSession&&e.RebootOverrideData.previousSessionId?d=e.RebootOverrideData.previousSessionId:(d=(r=P())[0],u=r[1]);var f=function(e,t,i,o,n){return void 0===n&&(n=!1),e.SessionInformation.IsCore&&(e.SessionInformation.HideViewerToolbar=!0),function(e,t){e.SessionInformation.WdParams||(e.SessionInformation.WdParams={});if(e.SessionInformation.WdParams.wd)return;t.substring(1).split("&").filter((function(t){if(0===t.indexOf("wd")){var i=t.split("=");i[0].length>2&&(e.SessionInformation.WdParams[i[0]]=i[1])}})),e.RebootOverrideData&&e.RebootOverrideData.isNewSession&&e.RebootOverrideData.previousSessionId&&(e.SessionInformation.WdParams.wdprevioussession=e.RebootOverrideData.previousSessionId)}(e,window.location.search),{container:e.Container,sessionInformation:e.SessionInformation,applicationUrl:e.ApplicationUrl,wopiPrecheckInfo:e.WopiPrecheckInfo,applicationCustomSettings:e.ApplicationCustomSettings,diagnostics:{HostInitializeDiagnostics:e.Diagnostics},fnOnInitializeSuccess:e.FnOnInitializeSuccess,fnOnInitializeFailure:e.FnOnInitializeFailure,sessionId:t,applicationBaseUrl:D(e.ApplicationUrl),wopiInfo:e.WopiInfo,forceSingleStepBoot:n,isCreateNew:e.WopiPrecheckInfo.IsNewFile||"1"===N(e.ApplicationUrl,"new"),featureManager:i||A(e.FnIsFeatureEnabled,o),newFileTemplateSource:e.NewFileTemplateSource,rebootOverrideData:e.RebootOverrideData}}(e,d,n,a=t||xe.getLogger(d,D(e.ApplicationUrl)+"RemoteUls.ashx"),this.bootstrapperParameters.forceSingleStepBoot);le(f.applicationBaseUrl,a),f.diagnostics.HostInitializeDiagnostics&&(f.diagnostics.HostInitializeDiagnostics.hostInitializeCallTime=l),$(a,f,u);var h,m=function(){return X(a,"OnBeforeUnload",!0)},w=function(){return X(a,"OnPageHide",!0)},S=function(){return X(a,"VisibilityChange_"+document.visibilityState,!0)},v=function(e){return function(e,t){if(e){var i=T(t);/{("isTrusted":\w{4,5})?}/.test(i)||(e.ULS.traceTag(594895886,B.WopiPendingApplication,g.Warning,"Unhandled Error:"+i),e.ULS.flush())}}(a,e)};window.addEventListener("beforeunload",m,{capture:!0,once:!0}),window.addEventListener("pagehide",w,{capture:!0}),window.addEventListener("visibilitychange",S,{capture:!0}),window.addEventListener("error",v,{capture:!0});var y=e&&e.BootstrapperUrl;y&&(h=this.periodicPrefetch(y,a));var F=function(){window.removeEventListener("beforeunload",m,{capture:!0}),window.removeEventListener("pagehide",w,{capture:!0}),window.removeEventListener("visibilitychange",S,{capture:!0}),window.removeEventListener("error",v,{capture:!0}),window.clearInterval(h)},C=_(e.ApplicationUrl),W=o||new _e(C,a),U=new De,E={},R=function(e,t){var i={isSingleStepBoot:e.forceSingleStepBoot,bootFlowType:e.forceSingleStepBoot?k.forceSingleStepBoot:k.bootWithoutWopiInfo,ignoreWacFramePostMessages:!1};if(e.forceSingleStepBoot,i.isSingleStepBoot){var o={singleStepBootIsRequired:!0,singleStepBootReason:i.bootFlowType,irmEnabled:e.wopiPrecheckInfo.IrmEnabled,readOnly:e.wopiPrecheckInfo.ReadOnly,ignoreWacFramePostMessages:i.ignoreWacFramePostMessages};t.ULS.traceTag(596444182,B.WopiPendingApplication,o.irmEnabled?g.Warning:g.Info,JSON.stringify(o))}else t.ULS.traceTag(596444183,B.WopiPendingApplication,g.Info,"Received input valid for two step flow");return i}(f,a),L=I(I({},f.diagnostics.HostInitializeDiagnostics),{officeSessionId:f.sessionId,officeBootstrapperVersion:b(),hostName:f.sessionInformation.HostName}),x=function(e,t,i,o,n,s,r,a,c){return function(p){q(e,n,s),G(n,o,g.Info),o.ULS.traceTag(596448985,B.WopiPendingApplication,g.Info,JSON.stringify(e));var l=c(t,o,i,r,p);try{a(l,e)}catch(e){o.ULS.traceTag(595719171,B.WopiPendingApplication,g.Error,"Exception thrown from host's success callback: "+T(e))}Z(o)}}(L,f.sessionId,W,a,E,U,F,e.FnOnInitializeSuccess,this.appFactory),H=function(e,t,i,o,n){return function(s){q(e,i,o),G(i,t,g.Warning),t.ULS.traceTag(596448986,B.WopiPendingApplication,g.Error,JSON.stringify({error:s,appInitDiagnostics:e}));try{n(s,e)}catch(e){t.ULS.traceTag(595719172,B.WopiPendingApplication,g.Error,"Exception thrown from host's failure callback: "+T(e))}Z(t)}}(L,a,E,U,e.FnOnInitializeFailure);if("undefined"!=typeof PerformanceResourceTiming&&void 0===PerformanceResourceTiming.prototype.toJSON&&(PerformanceResourceTiming.prototype.toJSON=function(){return{name:this.name,connectStart:this.connectStart,connectEnd:this.connectEnd}}),e.FnOnAppModeSwitched&&W.registerMessagePayloadHandler(s.ModeSwitched,e.FnOnAppModeSwitched),e.WopiPrecheckInfo.ReadOnly&&e.FnOnAppModeSwitched&&e.FnOnAppModeSwitched({NewMode:"view"}),y&&this.bootstrapperParameters.preloader&&this.bootstrapperParameters.preloader.shouldPreload(f.applicationUrl))try{if(f.featureManager&&f.featureManager.isFeatureEnabled(O.H2StaticContent)){a.ULS.traceTag(595645891,B.WopiPendingApplication,g.Info,"HTTP2 preload enabled");var z=(c=y,p=new RegExp("(c[1-5])h?(-)"),c.replace(p,"$1h$2"));this.bootstrapperParameters.preloader.preload(z,a,f.featureManager)}else this.bootstrapperParameters.preloader.preload(y,a,f.featureManager)}catch(e){a.ULS.traceTag(595943884,B.WopiPendingApplication,g.Error,T(e))}var V=new Le(f,R,L,a,W,E,F,x,H);return V.Boot(),V}catch(t){return a&&(a.ULS.traceTag(596459925,B.WopiPendingApplication,g.Error,M.AppInitError+": "+T(t)),a.ULS.flushOnClose()),void e.FnOnInitializeFailure({errorType:M.AppInitError,errorObject:t},void 0)}},e.prototype.periodicPrefetch=function(e,t){var i=this;return window.setInterval((function(){i.Prefetch({BootstrapperUrl:e}),t.ULS.traceTag(595895774,B.WopiPendingApplication,g.Info,"Prefetching "+V(e))}),36e5)},e}();!function(e){e.BrowserEvent="BrowserEvent",e.PageChanged="PageChanged",e.ZoomChanged="ZoomChanged",e.ContentRefreshBegin="ContentRefreshBegin",e.ContentRefreshEnd="ContentRefreshEnd",e.AppClosed="UI_Close",e.UserEdit="Edit_Notification",e.FileRename="File_Rename",e.FileShare="UI_Sharing",e.ShowFileVersions="UI_FileVersions",e.UIWorkflow="UI_Workflow",e.IsDisabled="IsDisabled",e.AccessibilityLoopComplete="App_AccessibilityLoopComplete",e.Unloaded="Unloaded",e.SwitchMode="App_SwitchMode",e.DocumentReboot="DocReboot",e.WopiInfoFromUrl="WopiInfoFromUrl",e.ModeSwitched="ModeSwitched"}(He||(He={}));var Be=function(){function e(e,t,i,o,n){this.eventHandlers={},this.isIndividualRegistrationCalled=!1,this.isAllRegistrationCalled=!1,this.sessionId=e,this.logger=t,this.innerApplicationFrame=n.innerApplicationFrame,this.postMessenger=i,this.onDisposedCallback=o,this.registerPostMessageHandlers(),re()}return e.prototype.GetApplicationType=function(){throw new Error("Not implemented")},e.prototype.GetVersion=function(){return b()},e.prototype.GetSessionId=function(){return this.sessionId},e.prototype.RegisterEventHandler=function(e,t){if(this.isAllRegistrationCalled)throw new Error("RegisterEventHandler is not supposed to be called");this.isIndividualRegistrationCalled=!0,this.registerEventHandlerInternal(e,t)},e.prototype.RemoveEventHandler=function(e,t){if(this.isAllRegistrationCalled)throw new Error("RemoveEventHandler is not supposed to be called");switch(e){case He.Unloaded:case He.DocumentReboot:case He.WopiInfoFromUrl:if(this.eventHandlers[e]!==t)throw new Error("The handler requested to be removed does not exist for the eventType");delete this.eventHandlers[e];break;default:this.postMessenger.removeMessageHandler(e)}},e.prototype.RegisterErrorHandler=function(e){},e.prototype.RemoveErrorHandler=function(e){},e.prototype.RegisterAllEventsHandler=function(e){var t=this;if(this.isIndividualRegistrationCalled)throw new Error("RegisterAllEventsHandler is not supposed to be called");if(this.isAllRegistrationCalled)throw new Error("RegisterAllEventsHandler is supposed to be called only once");this.isAllRegistrationCalled=!0,Object.keys(p).forEach((function(i){p[i].flowId===o.raiseEvent&&t.registerEventHandlerInternal(i,(function(t){return e({MessageId:i,SendTime:void 0,CorrelationId:void 0,Values:t})}))})),[s.FileEmbed,s.RefreshSessionInfo,s.UserAccessAndPermissions].forEach((function(i){t.registerEventHandlerInternal(i,(function(t){return e({MessageId:i,SendTime:void 0,CorrelationId:void 0,Values:t})}))}))},e.prototype.PostCommand=function(e,t){this.postMessenger.postMessageForCommand(this.innerApplicationFrame.contentWindow,e,t)},e.prototype.Dispose=function(e,t){var i=this;ae(e||!1,this.logger,this.postMessenger,this.innerApplicationFrame,(function(){delete i.innerApplicationFrame,i.onDisposedCallback(),i.postMessenger.dispose(),i.raiseEvent(He.Unloaded,{});for(var e=0,t=Object.keys(i.eventHandlers);e<t.length;e++){var o=t[e];delete i.eventHandlers[o]}}),t)},e.prototype.registerEventHandlerInternal=function(e,t){switch(e){case He.Unloaded:case He.DocumentReboot:case He.WopiInfoFromUrl:if(this.eventHandlers[e])throw new Error("Duplicate registration");this.eventHandlers[e]=t;break;default:this.postMessenger.registerMessagePayloadHandler(e,t)}},e.prototype.registerPostMessageHandlers=function(){this.postMessenger.registerMessagePayloadHandler(s.Reboot,this.handleDocumentRebootMessage.bind(this)),this.postMessenger.registerMessagePayloadHandler(s.GetWopiInfoFromUrl,this.handleWopiInfoFromUrlRequest.bind(this))},e.prototype.raiseEvent=function(e,t){var i=this.eventHandlers[e];if(i)try{i(t||{})}catch(e){this.logger.ULS.traceTag(593773706,B.WopiPendingApplication,g.Error,"Handler error: "+T(e))}},e.prototype.handleDocumentRebootMessage=function(e){e.previousSessionId=this.sessionId,this.raiseEvent(He.DocumentReboot,e)},e.prototype.handleWopiInfoFromUrlRequest=function(e){this.raiseEvent(He.WopiInfoFromUrl,e)},e}();var Ne=function(e){function t(t,i){var o=e.call(this,t,i)||this;return o.resources=[],o.coreResourcesToObserve=[],o.initResources(),o}return v(t,e),t.prototype.initResources=function(){var e;(e=[{domain:"excel",url:"Ewa"+this.debugSuffix+".js",localized:!1,type:"script"}]).push({domain:"excel",url:"Aacorlib"+this.minSuffix+".js",localized:!1,type:"script"}),e.push({domain:"excel",url:"CookieCompliance.js",localized:!1,type:"script"}),e.push({domain:"excel",url:"Ewa.Strings.Wac"+this.debugSuffix+".js",localized:!0,type:"script"}),e.push({domain:"excel",url:"EwrDefault.css",localized:!0,type:"css"}),e.push({domain:"excel",url:"excelframe.css",localized:!0,type:"css"}),e.push({domain:"excel",url:"gridRenderer"+this.minSuffix+".js",localized:!1,type:"script"}),this.featureManager&&this.featureManager.isFeatureEnabled(O.ExcelAdaptiveLayoutDownload)&&e.push({domain:"excel",url:"adaptiveLayout"+this.minSuffix+".js",localized:!1,type:"script"}),this.coreResourcesToObserve.push(this.bootstrapperPageName);for(var t=0,i=e;t<i.length;t++){var o=i[t],n=this.resourceHostUrl;this.coreResourcesToObserve.push(o.url),"/"!==n[n.length-1]&&(n+="/");var s="App_Scripts";"css"===o.type&&(s="Resources");var r="";o.localized&&(r="1033/"),n+="x/s/"+this.buildPrefix+"__layouts/"+s+"/"+r+o.url,this.resources.push(n)}},t}(function(){function e(e,t){this.resourceHostUrl=_(e),this.buildPrefix=function(){var e=b();0;if(!e)throw new Error("Build number not available");var t=e.split(".");if(4!==t.length)throw new Error("Build number has incorrect format");return t[0]+t[2]+t[3]}(),this.debugSuffix="",this.minSuffix=".min",this.resourceHint=function(){var e=K();if(e===H.Firefox||e===H.IE)return"prefetch";return"preload"}(),this.bootstrapperPageName=V(e),this.featureManager=t}return e.prototype.preloadResources=function(e){for(var t=0,i=this.resources;t<i.length;t++){var o=i[t];this.preloadResource(o,e)}},e.prototype.preloadResource=function(e,t){var i=document.createElement("link");if(i.setAttribute("crossorigin","anonymous"),i.rel=this.resourceHint,i.href=e,t){i.addEventListener("error",(function(){t.ULS.traceTag(595719107,B.WopiPendingApplication,g.Error,"Resource failed to load: "+V(e))}))}i.setAttribute("as","script"),document.head.appendChild(i)},e}()),ze=function(){function e(){}return e.prototype.shouldPreload=function(e){return this.isExcelsUrl(e)},e.prototype.preload=function(t,i,o){var n=new Ne(t,o);e.tryObserveResourceTiming(n.coreResourcesToObserve,i),n.preloadResources(i)},e.prototype.isExcelsUrl=function(e){return e.indexOf("xlviewerinternal.aspx")>=0},e.tryObserveResourceTiming=function(e,t){window.performance&&window.performance.getEntriesByType&&window.addEventListener("load",(function(){try{for(var i=0,o=window.performance.getEntriesByType("resource");i<o.length;i++){var n=o[i],s=V(n.name);if("about:blank"!==n.name&&-1===s.indexOf("RemoteUls.ashx")&&-1===s.indexOf("mhtml:file")&&-1!==e.indexOf(s)){var r=JSON.stringify(n);r=r.replace(new RegExp(n.name,"g"),s),t.ULS.traceTag(595736532,B.WopiPendingApplication,g.Info,r)}}window.performance.clearResourceTimings()}catch(e){t.ULS.traceTag(595732049,B.WopiPendingApplication,g.Info,"ExcelPreloader.tryObserveResourceTiming: could not trace resource timing, error is: "+JSON.stringify(e))}}),{once:!0})},e}();var Ve;!function(e){e[e.NotSupported=0]="NotSupported",e[e.SameDocOnly=1]="SameDocOnly",e[e.AnyDoc=2]="AnyDoc",e[e.OtherMode=4]="OtherMode"}(Ve||(Ve={})),i.d(t,"Application",(function(){return Je})),i.d(t,"DocRebootSupportMode",(function(){return Ve})),i.d(t,"CommandIds",(function(){return n})),i.d(t,"EventIds",(function(){return a}));var Je=new ke((function(e,t,i,o,n){return new Be(e,t,i,o,n)}),{forceSingleStepBoot:!0,preloader:new ze})}});

